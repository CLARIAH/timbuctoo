<html lang="en"
      xmlns:c="http://www.concordion.org/2007/concordion"
      xmlns:h="http://huygens.knaw.nl/concordion-http-verifier">
<head>
  <meta charset="UTF-8"/>
  <title>Timbuctoo v2.1 Relation search API</title>
</head>

<body>
<section data-type="chapter">
  <h2>Preface</h2>
  Timbuctoo 2.1 can start a relation search using a faceted search ID as starting point.
  <p>
    Currently The only implemented use cases are a search for receptions (in the form of wwdocuments) on:
    <ul>
      <li>wwpersons</li>
      <li>wwdocuments</li>
    </ul>
  </p>

  <p>
    <span c:execute="#personSearchId=getPersonSearchId()">For this test we assume an existing wwpersons search ID:
    <b><span c:echo="#personSearchId"></span></b>.</span>
  </p>
</section>
<section data-type="chapter">
  <h2>Performing reception search on wwpersons</h2>
  When you POST the wwpersons search ID to the relation search with wwdocuments to start the reception search on persons.
  <aside class="example highlight" h:http="#searchPost">
    <div h:request="">
      POST /v2.1/search/wwrelations/wwdocuments HTTP/1.1
      VRE_ID: WomenWriters
      Content-type: application/json

      {
        "otherSearchId": "#personSearchId"
      }
    </div>
    <div h:response="">
      HTTP/1.1 201
      Location:
    </div>
  </aside>
  <p>
    You get a Location header back (In this case <small><span c:echo="#searchPost.headers.location"></span></small>)
    that contains <span c:assertEquals="isFullyQualified(#searchPost.headers.location)">a fully qualified HTTP url</span>.
    This url is valid during the next few hours. Once it starts returning 404's you are expected to retry the POST.
  </p>
  <aside class="example highlight" h:http="#searchGet">
    <div h:request="">
      GET #searchPost.headers.location HTTP/1.1
    </div>
    <div h:response="">
      HTTP/1.1 200

      {
        "fullTextSearchFields": [
          "dynamic_t_author_name",
          "dynamic_t_title",
          "dynamic_t_notes"
        ],
        "facets": [
          {
            "name": "dynamic_s_author_marital_status",
            "type": "LIST"
          },
          {
            "name": "dynamic_s_author_gender",
            "type": "LIST"
          },
          {
            "name": "dynamic_s_author_education",
            "type": "LIST"
          },
          {
            "name": "dynamic_s_author_birthplace",
            "type": "LIST"
          },
          {
            "name": "dynamic_s_author_social_class",
            "type": "LIST"
          },
          {
            "name": "dynamic_s_author_types",
            "type": "LIST"
          },
          {
            "name": "dynamic_s_author_residence",
            "type": "LIST"
          },
          {
            "name": "dynamic_s_author_children",
            "type": "LIST"
          },
          {
            "name": "dynamic_s_author_religion",
            "type": "LIST"
          },
          {
            "name": "dynamic_s_origin",
            "type": "LIST"
          },
          {
            "name": "dynamic_s_document_type",
            "type": "LIST"
          },
          {
            "name": "dynamic_s_genre",
            "type": "LIST"
          },
          {
            "name": "dynamic_i_author_deathDate",
            "type": "RANGE"
          },
          {
            "name": "dynamic_s_author_financials",
            "type": "LIST"
          },
          {
            "name": "dynamic_s_sources",
            "type": "LIST"
          },
          {
            "name": "dynamic_s_author_deathplace",
            "type": "LIST"
          },
          {
            "name": "dynamic_s_author_profession",
            "type": "LIST"
          },
          {
            "name": "dynamic_s_language",
            "type": "LIST"
          },
          {
            "name": "dynamic_s_creator",
            "type": "LIST"
          },
          {
            "name": "dynamic_s_author_collective",
            "type": "LIST"
          },
          {
            "name": "dynamic_b_is_source",
            "type": "LIST"
          },
          {
            "name": "dynamic_i_modified",
            "type": "RANGE"
          },
          {
            "name": "dynamic_s_author_relatedLocations",
            "type": "LIST"
          },
          {
            "name": "dynamic_i_date",
            "type": "RANGE"
          },
          {
            "name": "dynamic_i_author_birthDate",
            "type": "RANGE"
          },
          {
            "name": "dynamic_s_relation",
            "type": "LIST"
          }
        ],
        "refs": [
          {
              "id": "/.+/",
              "path": "/.+/",
              "relationName": "/.+/",
              "sourceData": {
                  "_id": "/.+/",
                  "birthDate": "/.+/",
                  "deathDate": "/.+/",
                  "gender": "/.+/",
                  "modified_date": "/.+/",
                  "name": "/.+/",
                  "residenceLocation": "/.+/"
              },
              "sourceName": "/.+/",
              "targetData": {
                  "_id": "/.+/",
                  "authorGender": "/.+/",
                  "authorName": "/.+/",
                  "date": "/.+/",
                  "documentType": "/.+/",
                  "genre": "/.+/",
                  "language": "/.+/",
                  "modified_date": "/.+/",
                  "publishLocation": "/.+/",
                  "title": "/.+/"
              },
              "targetName": "/.+/",
              "type": "/.+/"
          },
          {
              "id": "/.+/",
              "path": "/.+/",
              "relationName": "/.+/",
              "sourceData": {
                  "_id": "/.+/",
                  "birthDate": "/.+/",
                  "deathDate": "/.+/",
                  "gender": "/.+/",
                  "modified_date": "/.+/",
                  "name": "/.+/",
                  "residenceLocation": "/.+/"
              },
              "sourceName": "/.+/",
              "targetData": {
                  "_id": "/.+/",
                  "authorGender": "/.+/",
                  "authorName": "/.+/",
                  "date": "/.+/",
                  "documentType": "/.+/",
                  "genre": "/.+/",
                  "language": "/.+/",
                  "modified_date": "/.+/",
                  "publishLocation": "/.+/",
                  "title": "/.+/"
              },
              "targetName": "/.+/",
              "type": "/.+/"
          },
          {
              "id": "/.+/",
              "path": "/.+/",
              "relationName": "/.+/",
              "sourceData": {
                  "_id": "/.+/",
                  "birthDate": "/.+/",
                  "deathDate": "/.+/",
                  "gender": "/.+/",
                  "modified_date": "/.+/",
                  "name": "/.+/",
                  "residenceLocation": "/.+/"
              },
              "sourceName": "/.+/",
              "targetData": {
                  "_id": "/.+/",
                  "authorGender": "/.+/",
                  "authorName": "/.+/",
                  "date": "/.+/",
                  "documentType": "/.+/",
                  "genre": "/.+/",
                  "language": "/.+/",
                  "modified_date": "/.+/",
                  "publishLocation": "/.+/",
                  "title": "/.+/"
              },
              "targetName": "/.+/",
              "type": "/.+/"
          },
          {
              "id": "/.+/",
              "path": "/.+/",
              "relationName": "/.+/",
              "sourceData": {
                  "_id": "/.+/",
                  "birthDate": "/.+/",
                  "deathDate": "/.+/",
                  "gender": "/.+/",
                  "modified_date": "/.+/",
                  "name": "/.+/",
                  "residenceLocation": "/.+/"
              },
              "sourceName": "/.+/",
              "targetData": {
                  "_id": "/.+/",
                  "authorGender": "/.+/",
                  "authorName": "/.+/",
                  "date": "/.+/",
                  "documentType": "/.+/",
                  "genre": "/.+/",
                  "language": "/.+/",
                  "modified_date": "/.+/",
                  "publishLocation": "/.+/",
                  "title": "/.+/"
              },
              "targetName": "/.+/",
              "type": "/.+/"
          },
          {
              "id": "/.+/",
              "path": "/.+/",
              "relationName": "/.+/",
              "sourceData": {
                  "_id": "/.+/",
                  "birthDate": "/.+/",
                  "deathDate": "/.+/",
                  "gender": "/.+/",
                  "modified_date": "/.+/",
                  "name": "/.+/",
                  "residenceLocation": "/.+/"
              },
              "sourceName": "/.+/",
              "targetData": {
                  "_id": "/.+/",
                  "authorGender": "/.+/",
                  "authorName": "/.+/",
                  "date": "/.+/",
                  "documentType": "/.+/",
                  "genre": "/.+/",
                  "language": "/.+/",
                  "modified_date": "/.+/",
                  "publishLocation": "/.+/",
                  "title": "/.+/"
              },
              "targetName": "/.+/",
              "type": "/.+/"
          },
          {
              "id": "/.+/",
              "path": "/.+/",
              "relationName": "/.+/",
              "sourceData": {
                  "_id": "/.+/",
                  "birthDate": "/.+/",
                  "deathDate": "/.+/",
                  "gender": "/.+/",
                  "modified_date": "/.+/",
                  "name": "/.+/",
                  "residenceLocation": "/.+/"
              },
              "sourceName": "/.+/",
              "targetData": {
                  "_id": "/.+/",
                  "authorGender": "/.+/",
                  "authorName": "/.+/",
                  "date": "/.+/",
                  "documentType": "/.+/",
                  "genre": "/.+/",
                  "language": "/.+/",
                  "modified_date": "/.+/",
                  "publishLocation": "/.+/",
                  "title": "/.+/"
              },
              "targetName": "/.+/",
              "type": "/.+/"
          },
          {
              "id": "/.+/",
              "path": "/.+/",
              "relationName": "/.+/",
              "sourceData": {
                  "_id": "/.+/",
                  "birthDate": "/.+/",
                  "deathDate": "/.+/",
                  "gender": "/.+/",
                  "modified_date": "/.+/",
                  "name": "/.+/",
                  "residenceLocation": "/.+/"
              },
              "sourceName": "/.+/",
              "targetData": {
                  "_id": "/.+/",
                  "authorGender": "/.+/",
                  "authorName": "/.+/",
                  "date": "/.+/",
                  "documentType": "/.+/",
                  "genre": "/.+/",
                  "language": "/.+/",
                  "modified_date": "/.+/",
                  "publishLocation": "/.+/",
                  "title": "/.+/"
              },
              "targetName": "/.+/",
              "type": "/.+/"
          },
          {
              "id": "/.+/",
              "path": "/.+/",
              "relationName": "/.+/",
              "sourceData": {
                  "_id": "/.+/",
                  "birthDate": "/.+/",
                  "deathDate": "/.+/",
                  "gender": "/.+/",
                  "modified_date": "/.+/",
                  "name": "/.+/",
                  "residenceLocation": "/.+/"
              },
              "sourceName": "/.+/",
              "targetData": {
                  "_id": "/.+/",
                  "authorGender": "/.+/",
                  "authorName": "/.+/",
                  "date": "/.+/",
                  "documentType": "/.+/",
                  "genre": "/.+/",
                  "language": "/.+/",
                  "modified_date": "/.+/",
                  "publishLocation": "/.+/",
                  "title": "/.+/"
              },
              "targetName": "/.+/",
              "type": "/.+/"
          },
          {
              "id": "/.+/",
              "path": "/.+/",
              "relationName": "/.+/",
              "sourceData": {
                  "_id": "/.+/",
                  "birthDate": "/.+/",
                  "deathDate": "/.+/",
                  "gender": "/.+/",
                  "modified_date": "/.+/",
                  "name": "/.+/",
                  "residenceLocation": "/.+/"
              },
              "sourceName": "/.+/",
              "targetData": {
                  "_id": "/.+/",
                  "authorGender": "/.+/",
                  "authorName": "/.+/",
                  "date": "/.+/",
                  "documentType": "/.+/",
                  "genre": "/.+/",
                  "language": "/.+/",
                  "modified_date": "/.+/",
                  "publishLocation": "/.+/",
                  "title": "/.+/"
              },
              "targetName": "/.+/",
              "type": "/.+/"
          },
          {
              "id": "/.+/",
              "path": "/.+/",
              "relationName": "/.+/",
              "sourceData": {
                  "_id": "/.+/",
                  "birthDate": "/.+/",
                  "deathDate": "/.+/",
                  "gender": "/.+/",
                  "modified_date": "/.+/",
                  "name": "/.+/",
                  "residenceLocation": "/.+/"
              },
              "sourceName": "/.+/",
              "targetData": {
                  "_id": "/.+/",
                  "authorGender": "/.+/",
                  "authorName": "/.+/",
                  "date": "/.+/",
                  "documentType": "/.+/",
                  "genre": "/.+/",
                  "language": "/.+/",
                  "modified_date": "/.+/",
                  "publishLocation": "/.+/",
                  "title": "/.+/"
              },
              "targetName": "/.+/",
              "type": "/.+/"
          }
        ],
        "start": "/[0-9]+/",
        "rows": "/[0-9]+/",
        "numFound": "/[0-9]+/",
        "sortableFields": []
      }
    </div>
  </aside>
</section>

<section data-type="chapter">
  <h2>Performing reception search with fulltext search parameter and filters</h2>
  When you POST with the same person search ID and valid facetValues + fullTextSearchParameters
  <aside class="example highlight" h:http="#searchPost2">
    <div h:request="">
      POST /v2.1/search/wwrelations/wwdocuments HTTP/1.1
      VRE_ID: WomenWriters
      Content-type: application/json

      {
        "otherSearchId": "#personSearchId",
        "facetValues":[
          {
            "name": "dynamic_s_relation",
            "values": ["commentsOnPerson", "mentionsPerson"]
          },
          {
            "name":"dynamic_i_date",
            "lowerLimit":17808662,
            "upperLimit":19058032
          }
        ],
        "fullTextSearchParameters": [
          {
            "name": "dynamic_t_title",
            "term": "private"
          }
        ]
      }
    </div>
    <div h:response="">
      HTTP/1.1 201
      Location:
    </div>
  </aside>
  <p>
    You get a new Location header back (In this case <small><span c:echo="#searchPost2.headers.location"></span></small>)
  </p>
  <aside class="example highlight" h:http="#searchGet2">
    <div h:request="">
      GET #searchPost2.headers.location HTTP/1.1
    </div>
    <div h:response="">
      HTTP/1.1 200

      {
        "fullTextSearchFields": [
          "dynamic_t_author_name",
          "dynamic_t_title",
          "dynamic_t_notes"
        ],
        "start": "/[0-9]+/",
        "rows": "/[0-9]+/",
        "numFound": "/[0-9]+/",
        "sortableFields": []
      }
    </div>
  </aside>
</section>
</body>
</html>

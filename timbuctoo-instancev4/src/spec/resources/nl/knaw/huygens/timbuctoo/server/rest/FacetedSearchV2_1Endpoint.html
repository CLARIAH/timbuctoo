<html lang="en"
      xmlns:c="http://www.concordion.org/2007/concordion"
      xmlns:h="http://huygens.knaw.nl/concordion-http-verifier">
<head>
  <meta charset="UTF-8"/>
  <title>Timbuctoo v2.1 Faceted search API</title>
</head>
<body>
  <section data-type="chapter">
    <h2>Preface</h2>
    Timbuctoo has support for building faceted searches. Doing a faceted search usually follows the following steps.
    <ol>
      <li>You <a href="#retrievingFacets">retrieve facets</a> by performing an empty POST to the search endpoint, and GET the returned location</li>
      <li>You present the returned facets to the user</li>
      <li>The user selects some combination of facets</li>
      <li>You <a href="#searchingUsingFacets">search</a> using the selected facets</li>
      <li>You present the returned results to the user and update your facet list based on the new facets</li>
      <li>The user updates its combination of facets</li>
      <li>etc.</li>
    </ol>
  </section>
  <section data-type="chapter">
    <h2>Retrieving facets</h2>
    Let's assume we're searching the collection <b>ckccpersons</b>.
    <aside class="example highlight" h:http="#searchPost">
        <div h:request="">
          POST /v2.1/search/ckccpersons HTTP/1.1
          VRE_ID: CKCC
          Content-type: application/json

          {}
        </div>
        <div h:response="">
          HTTP/1.1 201
          Location:
        </div>
    </aside>
    <p>
      You then get a Location header back (In this case <small><span c:echo="#searchPost.headers.location"></span></small>)
      that contains <span c:assertEquals="isFullyQualified(#searchPost.headers.location)">a fully qualified HTTP url</span>.
      This url is valid during the next few hours. Once it starts returning 404's you are expected to retry the POST.
    </p>
    <!--<aside id="emptyRetrieveResponse" class="example highlight" h:http="#searchGet">-->
      <!--<div h:request="">-->
        <!--GET #searchPost.headers.location HTTP/1.1-->
      <!--</div>-->
      <!--<div h:response="dontCheck">-->
        <!--HTTP/1.1 200-->

        <!--{-->
          <!--_next: (a url starting with http or https)-->
          <!--facets: [-->
            <!--A list of either:-->
            <!--{-->

              <!--name: (some string),-->
              <!--type: "LIST",-->
              <!--options: [{-->
                <!--name: (some string),-->
                <!--count: (a number)-->
              <!--}]-->
            <!--}-->
            <!--or-->
            <!--{-->
              <!--name: (some string),-->
              <!--type: "RANGE",-->
              <!--options: [{-->
                <!--upperLimit: (a number),-->
                <!--lowerLimit: (a number)-->
              <!--}]-->
            <!--}-->
          <!--],-->
          <!--fullTextSearchFields: ["dynamic_t_.+"],-->
          <!--refs: [{-->
            <!--data: {-->
              <!--some data, this differs per collection-->
            <!--},-->
            <!--displayName: (some string),-->
            <!--path: (a path _not_ starting with a /)-->
          <!--}],-->
          <!--sortableFields: ["fieldnameA", "fieldNameB"],-->
          <!--start: (a number),-->
          <!--rows: (a number),-->
          <!--numFound: (a number)-->
        <!--}-->
      <!--</div>-->
    <!--</aside>-->
    <!--<ul>-->
      <!--<li>-->
        <!--numFound contains the total number of records that match the query and is therefore always greater than, or-->
        <!--equal to the facet numbers and the rows property.-->
      <!--</li>-->
      <!--<li>-->
        <!--start contains the offset, in items-->
      <!--</li>-->
      <!--<li>-->
        <!--rows contains the amount of rows in the returned dataset. This is always equal to the length of the terms array-->
      <!--</li>-->
      <!--<li>-->
        <!--Rows might be less then 10 when the resultset contains no more items.-->
      <!--</li>-->
    <!--</ul>-->
  <!--</section>-->
  <!--<section data-type="chapter">-->
    <!--<h2>Searching with the selected facets</h2>-->
    <!--<p>-->
      <!--You can use the information in the facets, sortableFields and fullTextSearchFields to create a query form. You can-->
      <!--use the information from the refs property to show a set of results.-->
    <!--</p>-->
    <!--<p>-->
      <!--The form should then create a POST containing those facets and fulltext fields that you wish to filter on. Let's-->
      <!--use a different domain (charterportaal) for our next search.-->
    <!--</p>-->
    <!--<aside class="example highlight" h:http="#filteredPost">-->
      <!--<div h:request="">-->
        <!--POST /v2.1/search/wwpersons HTTP/1.1-->
        <!--VRE_ID: WomenWriters-->
        <!--Content-type: application/json-->

        <!--{-->
          <!--"facetValues":[-->
            <!--{"name":"dynamic_s_gender","values":["FEMALE"]},-->
            <!--{"name":"dynamic_s_residence","values":["France"]},-->
            <!--{"name":"dynamic_s_language","values":["English"]},-->
            <!--{"name":"dynamic_s_marital_status","values":["Widowed"]}-->
          <!--]-->
        <!--}-->
      <!--</div>-->
      <!--<div h:response="">-->
        <!--HTTP/1.1 201-->
        <!--Location:-->
      <!--</div>-->
    <!--</aside>-->
    <!--<aside class="example highlight" h:http="">-->
      <!--<div h:request="">-->
        <!--GET #filteredPost.headers.location HTTP/1.1-->
        <!--Accept: application/json-->
      <!--</div>-->
      <!--<div h:response="">-->
      <!--HTTP/1.1 200-->

      <!--{-->
        <!--"sortableFields": [-->
          <!--"dynamic_k_modified",-->
          <!--"dynamic_k_birthDate",-->
          <!--"dynamic_sort_name",-->
          <!--"dynamic_k_deathDate"-->
        <!--],-->
        <!--"numFound": 1,-->
        <!--"start": 0,-->
        <!--"rows": 1,-->
        <!--"term": "*",-->
        <!--"facets": [-->
          <!--{-->
            <!--"name": "dynamic_s_deathplace",-->
            <!--"title": "",-->
            <!--"options": [-->
              <!--{-->
                <!--"name": "Padova (ITA)",-->
                <!--"count": 1-->
              <!--}-->
            <!--],-->
            <!--"type": "LIST"-->
          <!--},-->
          <!--{-->
            <!--"name": "dynamic_s_relatedLocations",-->
            <!--"title": "",-->
            <!--"options": [-->
              <!--{-->
                <!--"name": "Austria",-->
                <!--"count": 1-->
              <!--},-->
              <!--{-->
                <!--"name": "France",-->
                <!--"count": 1-->
              <!--},-->
              <!--{-->
                <!--"name": "Italy",-->
                <!--"count": 1-->
              <!--},-->
              <!--{-->
                <!--"name": "London (ENG)",-->
                <!--"count": 1-->
              <!--},-->
              <!--{-->
                <!--"name": "Padova (ITA)",-->
                <!--"count": 1-->
              <!--},-->
              <!--{-->
                <!--"name": "Venezia (ITA)",-->
                <!--"count": 1-->
              <!--}-->
            <!--],-->
            <!--"type": "LIST"-->
          <!--},-->
          <!--{-->
            <!--"name": "dynamic_i_deathDate",-->
            <!--"title": "",-->
            <!--"options": [-->
              <!--{-->
                <!--"lowerLimit": 17910101,-->
                <!--"upperLimit": 17911231-->
              <!--}-->
            <!--],-->
            <!--"type": "RANGE"-->
          <!--},-->
          <!--{-->
            <!--"name": "dynamic_s_birthplace",-->
            <!--"title": "",-->
            <!--"options": [-->
              <!--{-->
                <!--"name": "Venezia (ITA)",-->
                <!--"count": 1-->
              <!--}-->
            <!--],-->
            <!--"type": "LIST"-->
          <!--},-->
          <!--{-->
            <!--"name": "dynamic_s_children",-->
            <!--"title": "",-->
            <!--"options": [-->
              <!--{-->
                <!--"name": "YES",-->
                <!--"count": 1-->
              <!--}-->
            <!--],-->
            <!--"type": "LIST"-->
          <!--},-->
          <!--{-->
            <!--"name": "dynamic_s_religion",-->
            <!--"title": "",-->
            <!--"options": [-->
              <!--{-->
                <!--"name": "Catholic",-->
                <!--"count": 1-->
              <!--}-->
            <!--],-->
            <!--"type": "LIST"-->
          <!--},-->
          <!--{-->
            <!--"name": "dynamic_s_residence",-->
            <!--"title": "",-->
            <!--"options": [-->
              <!--{-->
                <!--"name": "Austria",-->
                <!--"count": 1-->
              <!--},-->
              <!--{-->
                <!--"name": "France",-->
                <!--"count": 1-->
              <!--},-->
              <!--{-->
                <!--"name": "Italy",-->
                <!--"count": 1-->
              <!--},-->
              <!--{-->
                <!--"name": "London (ENG)",-->
                <!--"count": 1-->
              <!--},-->
              <!--{-->
                <!--"name": "Padova (ITA)",-->
                <!--"count": 1-->
              <!--},-->
              <!--{-->
                <!--"name": "Venezia (ITA)",-->
                <!--"count": 1-->
              <!--}-->
            <!--],-->
            <!--"type": "LIST"-->
          <!--},-->
          <!--{-->
            <!--"name": "dynamic_s_language",-->
            <!--"title": "",-->
            <!--"options": [-->
              <!--{-->
                <!--"name": "English",-->
                <!--"count": 1-->
              <!--},-->
              <!--{-->
                <!--"name": "French",-->
                <!--"count": 1-->
              <!--},-->
              <!--{-->
                <!--"name": "Italian",-->
                <!--"count": 1-->
              <!--}-->
            <!--],-->
            <!--"type": "LIST"-->
          <!--},-->
          <!--{-->
            <!--"name": "dynamic_s_marital_status",-->
            <!--"title": "",-->
            <!--"options": [-->
              <!--{-->
                <!--"name": "Liaison with man",-->
                <!--"count": 1-->
              <!--},-->
              <!--{-->
                <!--"name": "Married",-->
                <!--"count": 1-->
              <!--},-->
              <!--{-->
                <!--"name": "Widowed",-->
                <!--"count": 1-->
              <!--}-->
            <!--],-->
            <!--"type": "LIST"-->
          <!--},-->
          <!--{-->
            <!--"name": "dynamic_s_education",-->
            <!--"title": "",-->
            <!--"options": [-->
              <!--{-->
                <!--"name": "Educated at home",-->
                <!--"count": 1-->
              <!--}-->
            <!--],-->
            <!--"type": "LIST"-->
          <!--},-->
          <!--{-->
            <!--"name": "dynamic_i_modified",-->
            <!--"title": "",-->
            <!--"options": [-->
              <!--{-->
                <!--"lowerLimit": 20150610,-->
                <!--"upperLimit": 20150610-->
              <!--}-->
            <!--],-->
            <!--"type": "RANGE"-->
          <!--},-->
          <!--{-->
            <!--"name": "dynamic_s_gender",-->
            <!--"title": "",-->
            <!--"options": [-->
              <!--{-->
                <!--"name": "FEMALE",-->
                <!--"count": 1-->
              <!--}-->
            <!--],-->
            <!--"type": "LIST"-->
          <!--},-->
          <!--{-->
            <!--"name": "dynamic_s_social_class",-->
            <!--"title": "",-->
            <!--"options": [-->
              <!--{-->
                <!--"name": "Aristocracy by marriage",-->
                <!--"count": 1-->
              <!--},-->
              <!--{-->
                <!--"name": "Upper class",-->
                <!--"count": 1-->
              <!--}-->
            <!--],-->
            <!--"type": "LIST"-->
          <!--},-->
          <!--{-->
            <!--"name": "dynamic_s_financials",-->
            <!--"title": "",-->
            <!--"options": [-->
              <!--{-->
                <!--"name": "Investing\/losing her own money",-->
                <!--"count": 1-->
              <!--},-->
              <!--{-->
                <!--"name": "Stipend\/allowance\/pension",-->
                <!--"count": 1-->
              <!--}-->
            <!--],-->
            <!--"type": "LIST"-->
          <!--},-->
          <!--{-->
            <!--"name": "dynamic_i_birthDate",-->
            <!--"title": "",-->
            <!--"options": [-->
              <!--{-->
                <!--"lowerLimit": 17370101,-->
                <!--"upperLimit": 17371231-->
              <!--}-->
            <!--],-->
            <!--"type": "RANGE"-->
          <!--},-->
          <!--{-->
            <!--"name": "dynamic_s_profession",-->
            <!--"title": "",-->
            <!--"options": [-->
              <!--{-->
                <!--"name": "Fiction writer\/novelist",-->
                <!--"count": 1-->
              <!--},-->
              <!--{-->
                <!--"name": "Poet",-->
                <!--"count": 1-->
              <!--},-->
              <!--{-->
                <!--"name": "Salonni\u00e8re",-->
                <!--"count": 1-->
              <!--},-->
              <!--{-->
                <!--"name": "Writer",-->
                <!--"count": 1-->
              <!--}-->
            <!--],-->
            <!--"type": "LIST"-->
          <!--},-->
          <!--{-->
            <!--"name": "dynamic_s_types",-->
            <!--"title": "",-->
            <!--"options": [-->
              <!--{-->
                <!--"name": "AUTHOR",-->
                <!--"count": 1-->
              <!--}-->
            <!--],-->
            <!--"type": "LIST"-->
          <!--}-->
        <!--],-->
        <!--"refs": [-->
          <!--{-->
            <!--"type": "wwperson",-->
            <!--"id": "/.*/",-->
            <!--"path": "/domain/wwpersons/.*/",-->
            <!--"displayName": "Giustiniana Wynne",-->
            <!--"data": {-->
              <!--"_id": "/.*/",-->
              <!--"birthDate": "1737",-->
              <!--"deathDate": "1791",-->
              <!--"gender": "FEMALE",-->
              <!--"modified_date": "20150610",-->
              <!--"name": "Giustiniana Wynne",-->
              <!--"residenceLocation": "Austria;France;Italy;London (ENG);Padova (ITA);Venezia (ITA)"-->
            <!--}-->
          <!--}-->
        <!--],-->
        <!--"fullTextSearchFields": [-->
          <!--"dynamic_t_tempspouse",-->
          <!--"dynamic_t_notes",-->
          <!--"dynamic_t_name"-->
        <!--]-->
      <!--}-->
      <!--</div>-->
    <!--</aside>-->
  </section>
</body>
</html>

<?xml version="1.0"?>
<xs:schema xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns="http://www.w3.org/1999/xhtml" xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:svg="http://www.w3.org/2000/svg" targetNamespace="http://www.w3.org/1999/xhtml" elementFormDefault="qualified" attributeFormDefault="unqualified">

<xs:import namespace="http://www.w3.org/1998/Math/MathML" schemaLocation="mathml3/mathml3.xsd"/>
<xs:import namespace="http://www.w3.org/2000/svg" schemaLocation="svg/SVG.xsd"/>

<xs:element name="html">
  <xs:complexType>
    <xs:sequence>
      <xs:element ref="head"/>
      <xs:element ref="body"/>
    </xs:sequence>
    <xs:attributeGroup ref="globals"/>
  </xs:complexType>
</xs:element>
  
<xs:element name="head">
  <xs:complexType>
    <xs:sequence>
      <!-- Note that in order to produce a valid content model, title must be first -->
        <xs:element ref="title"/>
        <xs:choice minOccurs="0" maxOccurs="unbounded">
          <xs:element ref="base"/>
          <xs:element ref="command"/>
          <xs:element ref="link"/>
          <xs:element ref="meta"/>
          <xs:element ref="script"/>
          <xs:element ref="style"/>
      </xs:choice>
    </xs:sequence>
    <xs:attributeGroup ref="globals"/>
  </xs:complexType>
</xs:element>
  
<xs:element name="body">
  <xs:complexType>
    <xs:sequence>
      <xs:choice>
        <xs:element ref="h1" minOccurs="0"/>
        <xs:element name="header" minOccurs="0" type="bookmainheader"/>
      </xs:choice>
      <xs:element name="figure" minOccurs="0" type="coverfigure"/>
      <xs:choice maxOccurs="unbounded">
        <xs:element ref="nav"/>
        <xs:element name="section" type="bookmaindiv"/>
        <!-- Separate out parts, as they have specific child requirements -->
        <xs:element name="div" type="bookpart"/>
      </xs:choice>
    </xs:sequence>
    <xs:attribute name="data-type" use="required" fixed="book"/>
    <xs:attributeGroup ref="globals"/>
  </xs:complexType>
</xs:element>
  
<xs:element name="title">
  <xs:complexType mixed="true">
    <xs:complexContent>
      <xs:extension base="empty_elem_global_attrs"/>
    </xs:complexContent>
  </xs:complexType>
</xs:element>
  
<!-- HTML5 spec requires either href attr, target attr, or both, (not possible to represent this in Schema).
     In HTMLBook, we are formally requiring href -->
<xs:element name="base">
  <xs:complexType>
    <xs:complexContent>
      <xs:extension base="empty_elem_global_attrs">
        <xs:attribute name="href" type="xs:anyURI" use="required"/>
        <xs:attribute name="target" type="xs:string"/>
      </xs:extension>
    </xs:complexContent>
  </xs:complexType>
</xs:element>
    
<xs:element name="link">
  <xs:complexType>
    <xs:complexContent>
      <xs:extension base="empty_elem_global_attrs">
        <xs:attribute name="href" type="xs:anyURI" use="required"/>
        <xs:attribute name="hreflang" type="xs:language"/>
        <xs:attribute name="media" type="xs:string"/>
        <xs:attribute name="ref" type="xs:NMTOKENS"/>
        <xs:attribute name="sizes" type="xs:NMTOKENS"/>
        <xs:attribute name="type" type="xs:string"/>
      </xs:extension>
    </xs:complexContent>
  </xs:complexType>
</xs:element>

<!-- For HTMLBook, all book metadata should be encapsulated in name-value pairs using @name and @content attrs, respectively.
     These two attrs are required on each element.
-->
<xs:element name="meta">
  <xs:complexType>
    <xs:complexContent mixed="true">
      <xs:extension base="empty_elem_global_attrs">
        <xs:attribute name="name" type="xs:string" use="required"/>
        <xs:attribute name="content" type="xs:string" use="required"/>
        <xs:attribute name="charset" type="xs:string"/>
        <xs:attribute name="http-equiv">
          <xs:simpleType>
            <xs:restriction base="xs:token">
              <xs:enumeration value="content-language"/>
              <xs:enumeration value="content-type"/>
              <xs:enumeration value="default-style"/>
              <xs:enumeration value="refresh"/>
              <xs:enumeration value="set-cookie"/>
            </xs:restriction>
          </xs:simpleType>
        </xs:attribute>
      </xs:extension>
    </xs:complexContent>
  </xs:complexType>
</xs:element>

  <!-- Not supporting the "noscript" element in HTMLBook, as HTML5 spec states 
    "it has no effect in the XHTML syntax" (http://www.w3.org/TR/2011/WD-html5-20110525/scripting-1.html#the-noscript-element) -->
<!-- <xs:element name="noscript"> -->

<!-- In HTMLBook, not allowing JS content to be embedded directly in script tag, and are requiring a @src attr -->
<xs:element name="script">
  <xs:complexType>
    <xs:complexContent>
      <xs:extension base="empty_elem_global_attrs">
        <xs:attribute name="src" type="xs:anyURI" use="required"/>
        <xs:attribute name="async">
          <xs:simpleType>
            <xs:restriction base="xs:token">
              <xs:pattern value="([Aa][Ss][Yy][Nn][Cc])?"/>
            </xs:restriction>
          </xs:simpleType>
        </xs:attribute>
        <xs:attribute name="defer">
          <xs:simpleType>
            <xs:restriction base="xs:token">
              <xs:pattern value="([Dd][Ee][Ff][Ee][Rr])?"/>
            </xs:restriction>
          </xs:simpleType>
        </xs:attribute>
        <xs:attribute name="type" type="xs:string"/>
        <xs:attribute name="charset" type="xs:string"/>
      </xs:extension>
    </xs:complexContent>
  </xs:complexType>
</xs:element>
    
<xs:element name="style">
  <xs:complexType mixed="true">
      <xs:attribute name="media" type="xs:string"/>
      <xs:attribute name="type" type="xs:string"/>
      <xs:attribute name="scoped">
        <xs:simpleType>
          <xs:restriction base="xs:token">
            <xs:pattern value="([Ss][Cc][Oo][Pp][Ee][Dd])?"/>
          </xs:restriction>
        </xs:simpleType>
      </xs:attribute>
      <xs:attributeGroup ref="globals"/>
  </xs:complexType>
</xs:element>
  
<!-- Block elements -->
  
<!-- For now, limit "address" to support only inline element children -->
<xs:element name="address" type="inlines_mml_and_svg"/>

<xs:element name="aside" type="sidebar"/>

<!-- Note, per HTML5 spec, the actual requirements are a choice between:
    * a @src attribute on <audio> elem and no <source> children
    * no @src attribute on <audio> elem and 1 or more <source> children
    But this logic is impossible to capture in Schema, so not going to enforce -->
<xs:element name="audio">
  <xs:complexType mixed="true">
    <xs:sequence>
      <xs:element ref="source" minOccurs="0" maxOccurs="unbounded"/>
      <xs:element ref="track" minOccurs="0" maxOccurs="unbounded"/>
    </xs:sequence>
    <xs:attributeGroup ref="generalmediaattributes"/>
    <xs:attributeGroup ref="globals"/>
  </xs:complexType>
</xs:element>
  
<xs:element name="blockquote">
  <xs:complexType>
    <xs:complexContent>
      <xs:extension base="block_xor_inline_children">
        <xs:attribute name="cite" type="xs:anyURI"/>
      </xs:extension>
    </xs:complexContent>
  </xs:complexType>
</xs:element> 

<xs:element name="canvas">
  <xs:complexType>
    <xs:complexContent>
      <xs:extension base="block_xor_inline_children">
        <xs:attribute name="width" type="positive_int"/>
        <xs:attribute name="height" type="positive_int"/>
      </xs:extension>
    </xs:complexContent>
  </xs:complexType>
</xs:element>
  
<xs:element name="details">
  <xs:complexType mixed="true">
    <xs:sequence>
      <xs:element ref="summary" minOccurs="0" maxOccurs="1"/>
      <xs:choice>
        <xs:group ref="blockelements" minOccurs="0" maxOccurs="unbounded"/>
        <xs:group ref="inlineelements" minOccurs="0" maxOccurs="unbounded"/>
      </xs:choice>
    </xs:sequence>
    <xs:attribute name="open">
      <xs:simpleType>
        <xs:restriction base="xs:token">
          <xs:pattern value="([Oo][Pp][Ee][Nn])?"/>
        </xs:restriction>
      </xs:simpleType>
    </xs:attribute>
    <xs:attributeGroup ref="globals"/>
  </xs:complexType>
</xs:element>

<!-- Two choices for div content model:
     1. Block children only, with an optional h1-h6 to start
     2. Inline children only, no heading
-->
<xs:element name="div">
  <xs:complexType mixed="true">
    <xs:choice>
      <!-- Option 1: Optional heading(s) followed by block elements -->
      <xs:sequence>
        <xs:group ref="headings" minOccurs="0" maxOccurs="unbounded"/>
        <xs:group ref="blockelements" minOccurs="0" maxOccurs="unbounded"/>
      </xs:sequence>
      <!-- Option 2: inlines and text only -->
      <xs:group ref="inlineelements" minOccurs="0" maxOccurs="unbounded"/>
    </xs:choice>
    <xs:attributeGroup ref="globals"/>
  </xs:complexType>
</xs:element>
    
<xs:element name="dl">
  <xs:complexType>
    <xs:sequence maxOccurs="unbounded">
      <xs:element ref="dt" minOccurs="1" maxOccurs="unbounded"/>
      <xs:element ref="dd" minOccurs="1" maxOccurs="unbounded"/>
    </xs:sequence>
    <xs:attributeGroup ref="globals"/>
  </xs:complexType>
</xs:element>

<xs:element name="embed">
  <xs:complexType>
    <xs:complexContent>
      <xs:extension base="empty_elem_global_attrs">
        <xs:attribute name="src" type="xs:anyURI"/>
        <xs:attribute name="type" type="xs:string"/>
        <xs:attribute name="width" type="xs:string"/>
        <xs:attribute name="height" type="xs:string"/>
      </xs:extension>
    </xs:complexContent>
  </xs:complexType>
</xs:element>
  
<xs:element name="fieldset">
  <xs:complexType mixed="true">
    <xs:sequence>
      <xs:element ref="legend" minOccurs="0" maxOccurs="1"/>
      <xs:choice>
        <xs:group ref="blockelements" minOccurs="0" maxOccurs="unbounded"/>
        <xs:group ref="inlineelements" minOccurs="0" maxOccurs="unbounded"/>
      </xs:choice>
    </xs:sequence>
    <xs:attribute name="disabled" type="disabled_boolean"/>    
    <xs:attribute name="name" type="xs:string"/>
    <xs:attribute name="form" type="xs:IDREF"/>
    <xs:attributeGroup ref="globals"/>
  </xs:complexType>
</xs:element>

<!-- We're deviating from the HTML5 spec in that we're only allowing block elements inside figure,
     and we're requiring a caption (which can come at either beginning or end) -->
<xs:element name="figure">
  <xs:complexType>
    <xs:choice>
      <xs:sequence>
        <xs:element ref="figcaption"/>
        <xs:group ref="figure_elements" maxOccurs="unbounded"/>
      </xs:sequence>
      <xs:sequence>
        <xs:group ref="figure_elements" maxOccurs="unbounded"/>
        <xs:element ref="figcaption"/>
      </xs:sequence>
    </xs:choice>
    <xs:attributeGroup ref="globals"/>
  </xs:complexType>
</xs:element>

<!-- Custom type for cover figures; no caption -->
<xs:complexType name="coverfigure">
  <xs:group ref="figure_elements" maxOccurs="unbounded"/>
  <xs:attribute name="data-type" fixed="cover" use="required"/>
  <xs:attributeGroup ref="globals"/>
</xs:complexType>

<xs:element name="form">
  <xs:complexType>
    <xs:choice minOccurs="0" maxOccurs="unbounded">
      <!-- All block elements, except "form"; yes, I'm reproducing the list here, rather than split up the
           "blockelements" group -->
      <xs:element ref="address"/>
      <xs:element ref="aside"/>
      <xs:element ref="audio"/>
      <xs:element ref="blockquote"/>
      <xs:element ref="canvas"/>
      <xs:element ref="details"/>
      <xs:element ref="div"/>
      <xs:element ref="dl"/>
      <xs:element ref="embed"/>
      <xs:element ref="fieldset"/>
      <xs:element ref="figure"/>
      <xs:element ref="hr"/>
      <xs:element ref="iframe"/>
      <xs:element ref="map"/>
      <xs:element ref="mml:math"/>
      <xs:element ref="menu"/>
      <xs:element ref="object"/>
      <xs:element ref="ol"/>
      <xs:element ref="p"/>
      <xs:element ref="pre"/>
      <xs:element ref="svg:svg"/>
      <xs:element ref="table"/>
      <xs:element ref="ul"/>
      <xs:element ref="video"/>
    </xs:choice>
    <xs:attribute name="accept-charset" type="xs:NMTOKENS"/>
    <xs:attribute name="action">
      <xs:simpleType>
        <xs:restriction base="xs:anyURI">
          <xs:minLength value="1"/>
        </xs:restriction>
      </xs:simpleType>
    </xs:attribute>
    <xs:attribute name="autocomplete" type="on_off"/>
    <xs:attribute name="enctype" type="enctype_formenctype"/>    
    <xs:attribute name="method" type="method_formmethod"/>    
    <!-- HTML5 also requires a form's name attribute to be unique among all other forms' name attributes,
         but skipping that requirement here -->
    <xs:attribute name="name">
      <xs:simpleType>
        <xs:restriction base="xs:string">
          <xs:minLength value="1"/>
        </xs:restriction>
      </xs:simpleType>
    </xs:attribute>
    <xs:attribute name="novalidate">
      <xs:simpleType>
        <xs:restriction base="xs:token">
          <xs:pattern value="([Nn][Oo][Vv][Aa][Ll][Ii][Dd][Aa][Tt][Ee])?"/>
        </xs:restriction>
      </xs:simpleType>
    </xs:attribute>
    <xs:attribute name="target" type="xs:string"/>
    <xs:attributeGroup ref="globals"/>
  </xs:complexType>
</xs:element>
  
<xs:element name="hr" type="empty_elem_global_attrs"/>
  
<xs:element name="iframe">
  <xs:complexType mixed="true">
    <xs:group ref="inlineelements" minOccurs="0" maxOccurs="unbounded"/>
    <!-- Differing from HTML5 spec in that we're requiring a @src attribute here -->
    <xs:attribute name="src" use="required" type="xs:anyURI"/>
    <xs:attribute name="srcdoc" type="xs:string"/>
    <xs:attribute name="name" type="xs:string"/>
    <xs:attribute name="sandbox">
      <xs:simpleType>
        <xs:restriction base="xs:string">
          <!-- Ugly regex alert, because backreferences are not allowed in XML Schema -->
          <xs:pattern value="allow-(same-origin|top-navigation|forms|scripts)( allow-(same-origin|top-navigation|forms|scripts))*"/>
        </xs:restriction>
      </xs:simpleType>
    </xs:attribute>
    <xs:attribute name="seamless">
      <xs:simpleType>
        <xs:restriction base="xs:token">
          <xs:pattern value="([Ss][Ee][Aa][Mm][Ll][Ee][Ss][Ss])?"/>
        </xs:restriction>
      </xs:simpleType>
    </xs:attribute>
    <xs:attribute name="width" type="xs:string"/>
    <xs:attribute name="height" type="xs:string"/>
    <xs:attributeGroup ref="globals"/>
  </xs:complexType>
</xs:element>

<!-- Requiring block content model for "map" element for simplicity -->
<xs:element name="map">
  <xs:complexType>
    <xs:group ref="map_elements" minOccurs="0" maxOccurs="unbounded"/>
    <!-- Not enforcing two restrictions from HTML5 for name attribute: uniqueness against other name attributes on map, 
         and requirement that it match id value, if present -->
    <xs:attribute name="name" use="required">
      <xs:simpleType>
        <xs:restriction base="xs:token">
          <!-- nonempty and no spaces -->
          <xs:minLength value="1"/>
          <xs:pattern value="[^ ]*"/>
        </xs:restriction>
      </xs:simpleType>
    </xs:attribute>
    <xs:attributeGroup ref="globals"/>
  </xs:complexType>
</xs:element>

<!-- Not imposing any HTMLBook specific constraints on menu content; deferring to HTML5 spec -->
<xs:element name="menu">
  <xs:complexType>
    <xs:choice>
      <xs:element ref="li" maxOccurs="unbounded"/>
      <xs:choice>
        <xs:group ref="blockelements" minOccurs="0" maxOccurs="unbounded"/>
        <xs:group ref="inlineelements" minOccurs="0" maxOccurs="unbounded"/>
      </xs:choice>
    </xs:choice>
    <xs:attribute name="type">
      <xs:simpleType>
        <xs:restriction base="xs:token">
          <xs:enumeration value="context"/>
          <xs:enumeration value="toolbar"/>
        </xs:restriction>
      </xs:simpleType>
    </xs:attribute>
    <xs:attribute name="label" type="xs:string"/>
    <xs:attributeGroup ref="globals"/>
  </xs:complexType>
</xs:element>
  
<!--Follows the EPUB 3 spec for nav elements; see http://www.idpf.org/epub/30/spec/epub30-contentdocs.html#sec-xhtml-nav -->
<xs:element name="nav">
  <xs:complexType>
    <xs:sequence>
      <xs:group ref="headings" minOccurs="0"/>
      <xs:element name="ol" type="nav_doc_ol" minOccurs="0"/>
    </xs:sequence>
    <xs:attribute name="data-type" use="required" fixed="toc"/>
    <xs:attributeGroup ref="globals"/>
  </xs:complexType>
</xs:element>
  
<xs:element name="object">
  <xs:complexType mixed="true">
    <xs:sequence>
      <xs:element ref="param" minOccurs="0" maxOccurs="1"/>
      <xs:choice>
        <xs:group ref="blockelements" minOccurs="0" maxOccurs="unbounded"/>
        <xs:group ref="inlineelements" minOccurs="0" maxOccurs="unbounded"/>
      </xs:choice>
    </xs:sequence>
    <xs:attribute name="data">
      <xs:simpleType>
        <xs:restriction base="xs:anyURI">
          <xs:minLength value="1"/>
        </xs:restriction>
      </xs:simpleType>
    </xs:attribute>
    <xs:attribute name="type" type="xs:string"/>
    <xs:attribute name="name" type="xs:string"/>
    <xs:attribute name="usemap" type="hash_name"/>    
    <!-- form attribute must refer to ID of a <form> element, but we're just checking that it's an IDREF -->
    <xs:attribute name="form" type="xs:IDREF"/>
    <xs:attribute name="width" type="xs:string"/>
    <xs:attribute name="height" type="xs:string"/>
    <xs:attributeGroup ref="globals"/>
  </xs:complexType>
</xs:element>

<xs:element name="ol">
  <xs:complexType>
    <xs:sequence>
      <!-- "li"s in an "ol" can have a value attribute -->
      <xs:element name="li" minOccurs="0" maxOccurs="unbounded">
        <xs:complexType>
          <xs:complexContent>
            <xs:extension base="block_xor_inline_children">
              <xs:attribute name="value" type="positive_int"/>
            </xs:extension>
          </xs:complexContent>
        </xs:complexType>
      </xs:element>
    </xs:sequence>
    <xs:attributeGroup ref="ol_attrs"/>
    <xs:attributeGroup ref="globals"/>
  </xs:complexType>
</xs:element>
  
<xs:element name="p" type="inlines_mml_and_svg"/>
  
<xs:element name="pre">
  <xs:complexType>
    <xs:complexContent>
      <xs:extension base="inlines_mml_and_svg">
        <xs:attribute name="data-code-language" type="xs:token"/>
      </xs:extension>
    </xs:complexContent>
  </xs:complexType>
</xs:element>
  
<!-- Default global version of "section" element is for chapter-level book divisions
     (allows for modularization of HTML files at the chapter level),
     but see other complex types below for content models for lower-level sections --> 
<xs:element name="section" type="bookmaindiv"/>
  
<xs:element name="table">
  <xs:complexType>
    <xs:sequence>
      <xs:element ref="caption" minOccurs="0"/>
      <xs:element ref="colgroup" minOccurs="0" maxOccurs="unbounded"/>
      <xs:element ref="thead" minOccurs="0"/>
      <xs:choice>
        <xs:element ref="tbody" minOccurs="0" maxOccurs="unbounded"/>
        <xs:element ref="tr" maxOccurs="unbounded"/>
      </xs:choice>
      <!-- In order to simplify and ensure determinist content model, departing from the HTML5 spec
           and requiring tfoot to come at end of table, which is more intuitive anyway -->
      <xs:element ref="tfoot" minOccurs="0"/>
    </xs:sequence>
    <xs:attribute name="border">
      <xs:simpleType>
        <xs:restriction base="xs:string">
          <!-- Per HTML5 spec, we're accepting either the value 1 or an empty string here -->
          <xs:pattern value="1?"/>
        </xs:restriction>
      </xs:simpleType>
    </xs:attribute>
    <xs:attributeGroup ref="globals"/>
  </xs:complexType>
</xs:element>
  
<xs:element name="ul">
  <xs:complexType>
    <xs:sequence>
      <xs:element ref="li" minOccurs="0" maxOccurs="unbounded"/>
    </xs:sequence>
    <xs:attributeGroup ref="globals"/>
  </xs:complexType>
</xs:element>
  
<xs:element name="video">
  <xs:complexType mixed="true">
    <xs:sequence>
      <xs:element ref="source" minOccurs="0" maxOccurs="unbounded"/>
      <xs:element ref="track" minOccurs="0" maxOccurs="unbounded"/>
    </xs:sequence>
    <xs:attributeGroup ref="videomediaattributes"/>
    <xs:attributeGroup ref="globals"/>
  </xs:complexType>
</xs:element>
  
<!-- Inline elements -->

<!-- Open question: allow block content within an <a>? Right now, restricting only to inline elements -->   
<xs:element name="a">
  <xs:complexType>
    <xs:complexContent>
      <xs:extension base="inlines_mml_and_svg">
        <!-- ToDo: Any further attribute restrictions -->
        <xs:attribute name="href" type="xs:anyURI"/>
        <xs:attribute name="hreflang" type="xs:language"/>
        <xs:attribute name="rel" type="xs:NMTOKENS"/>
        <xs:attribute name="target" type="xs:string"/>
        <xs:attribute name="type" type="xs:string"/>
        <!-- The following attributes are for indexterms -->
        <xs:attribute name="data-primary" type="xs:string"/>
        <xs:attribute name="data-secondary" type="xs:string"/>
        <xs:attribute name="data-tertiary" type="xs:string"/>
        <xs:attribute name="data-see" type="xs:string"/>
        <xs:attribute name="data-seealso" type="xs:string"/>
        <xs:attribute name="data-sortas" type="xs:string"/>
      </xs:extension>
    </xs:complexContent>
  </xs:complexType>
</xs:element>
  
<xs:element name="abbr" type="inlines_mml_and_svg"/>

<xs:element name="b" type="inlines_mml_and_svg"/>
  
<xs:element name="bdi" type="inlines_mml_and_svg"/>
  
<xs:element name="bdo">
  <xs:complexType mixed="true">
    <xs:sequence>
      <xs:group ref="inlines_plus_mml_and_svg" minOccurs="0" maxOccurs="unbounded"/>
    </xs:sequence>
    <!-- Adding the dir attribute here instead of specifying it in the "globals" attribute group
         to modify to include use="required" --> 
    <xs:attribute name="dir" use="required">
      <xs:simpleType>
        <xs:restriction base="xs:token">
          <xs:enumeration value="ltr"/>
          <xs:enumeration value="rtl"/>              
        </xs:restriction>
      </xs:simpleType>
    </xs:attribute>
    <xs:attributeGroup ref="globals_minus_dir"/>
  </xs:complexType>
</xs:element>
  
<xs:element name="br" type="empty_elem_global_attrs"/>

<xs:element name="button">
  <!-- button elements can have any inline children, excluding other interactive elements -->
  <xs:complexType mixed="true">
    <xs:choice minOccurs="0" maxOccurs="unbounded">
      <xs:element ref="a"/>
      <xs:element ref="abbr"/>
      <xs:element ref="b"/>
      <xs:element ref="bdi"/>
      <xs:element ref="bdo"/>
      <xs:element ref="br"/>
      <xs:element ref="cite"/>
      <xs:element ref="code"/>
      <xs:element ref="del"/>
      <xs:element ref="dfn"/>
      <xs:element ref="em"/>
      <xs:element ref="i"/>
      <xs:element ref="img"/>
      <xs:element ref="ins"/>
      <xs:element ref="kbd"/> 
      <xs:element ref="mark"/>  
      <xs:element ref="meter"/>
      <xs:element ref="output"/>
      <xs:element ref="progress"/>
      <xs:element ref="q"/>
      <xs:element ref="ruby"/>
      <xs:element ref="s"/>
      <xs:element ref="samp"/>
      <xs:element ref="small"/>
      <xs:element ref="span"/>
      <xs:element ref="strong"/>
      <xs:element ref="sub"/>
      <xs:element ref="sup"/>
      <xs:element ref="time"/>
      <xs:element ref="u"/>
      <xs:element ref="var"/>
      <xs:element ref="wbr"/>
    </xs:choice>
    <xs:attribute name="autofocus" type="autofocus_boolean"/>    
    <xs:attribute name="disabled" type="disabled_boolean"/>    
    <!-- form attribute must refer to ID of a <form> element, but we're just checking that it's an IDREF -->
    <xs:attribute name="form" type="xs:IDREF"/>
    <xs:attribute name="formaction">
      <xs:simpleType>
        <xs:restriction base="xs:anyURI">
          <xs:minLength value="1"/>
        </xs:restriction>
      </xs:simpleType>
    </xs:attribute>
    <xs:attribute name="formenctype" type="enctype_formenctype"/>    
    <xs:attribute name="formmethod" type="method_formmethod"/>    
    <xs:attribute name="formnovalidate" type="formnovalidate_boolean"/>    
    <xs:attribute name="formtarget" type="xs:string"/>
    <xs:attribute name="name" type="xs:string"/>
    <xs:attribute name="type">
      <xs:simpleType>
        <xs:restriction base="xs:token">
          <xs:enumeration value="submit"/>
          <xs:enumeration value="reset"/>
          <xs:enumeration value="button"/>
        </xs:restriction>
      </xs:simpleType>
    </xs:attribute>
    <xs:attribute name="value" type="xs:string"/>
    <xs:attributeGroup ref="globals"/>
  </xs:complexType>
</xs:element>
  
<xs:element name="cite" type="inlines_mml_and_svg"/>

<!-- Can also be used in document head -->
<xs:element name="command">
  <xs:complexType>
    <xs:complexContent>
      <xs:extension base="empty_elem_global_attrs">
        <xs:attribute name="type">
          <xs:simpleType>
            <xs:restriction base="xs:token">
              <xs:enumeration value="command"/>
              <xs:enumeration value="checkbox"/>
              <xs:enumeration value="radio"/>
            </xs:restriction>
          </xs:simpleType>
        </xs:attribute>
        <xs:attribute name="label" use="required">
          <xs:simpleType>
            <xs:restriction base="xs:string">
              <xs:minLength value="1"/>
            </xs:restriction>
          </xs:simpleType>
        </xs:attribute>
        <xs:attribute name="icon" type="xs:anyURI"/>
        <xs:attribute name="disabled" type="disabled_boolean"/>        
        <xs:attribute name="checked" type="checked_boolean"/>        
        <!-- In HTML5 spec, "radio" attribute can only be enabled for type="radio", but can't enforce that in Schema -->
        <xs:attribute name="radiogroup" type="xs:string"/>
      </xs:extension>
    </xs:complexContent>
  </xs:complexType>
</xs:element>

<xs:element name="code" type="inlines_mml_and_svg"/>
  
<xs:element name="datalist">
  <xs:complexType>
    <xs:choice>
      <xs:group ref="inlineelements" minOccurs="0" maxOccurs="unbounded"/>
      <xs:element ref="option" minOccurs="0" maxOccurs="unbounded"/>
    </xs:choice>
    <xs:attributeGroup ref="globals"/>
  </xs:complexType>
</xs:element>
  
<!-- To simplify content model, "del" element is only allowed in inline contexts in HTMLBook -->
<xs:element name="del">
  <xs:complexType>
    <xs:complexContent>
      <xs:extension base="inlines_mml_and_svg">
        <xs:attribute name="cite" type="xs:anyURI"/>
        <xs:attribute name="datetime" type="xs:string"/>
      </xs:extension>
    </xs:complexContent>
  </xs:complexType>
</xs:element>
  
<xs:element name="dfn">
  <!-- dfn elements can have any inline children, excluding another "dfn" element -->
  <xs:complexType mixed="true">
      <xs:choice minOccurs="0" maxOccurs="unbounded">
        <!-- Yeah we're enumerating all the inline options (from "inlineelements") here minus dfn, as there's no way to exclude just one item for a group,
             and I don't want to break up the "inlineelements" group below-->
        <xs:element ref="a"/>
        <xs:element ref="abbr"/>
        <xs:element ref="b"/>
        <xs:element ref="bdi"/>
        <xs:element ref="bdo"/>
        <xs:element ref="br"/>
        <xs:element ref="button"/>
        <xs:element ref="command"/>
        <xs:element ref="cite"/>
        <xs:element ref="code"/>
        <xs:element ref="datalist"/>
        <xs:element ref="del"/>
        <xs:element ref="em"/>
        <xs:element ref="i"/>
        <xs:element ref="img"/>
        <xs:element ref="input"/>
        <xs:element ref="ins"/>
        <xs:element ref="kbd"/>
        <xs:element ref="keygen"/>  
        <xs:element ref="label"/>  
        <xs:element ref="mark"/>  
        <xs:element ref="meter"/>
        <xs:element ref="output"/>
        <xs:element ref="progress"/>
        <xs:element ref="q"/>
        <xs:element ref="ruby"/>
        <xs:element ref="s"/>
        <xs:element ref="samp"/>
        <xs:element ref="select"/>
        <xs:element ref="small"/>
        <xs:element ref="span"/>
        <xs:element ref="strong"/>
        <xs:element ref="sub"/>
        <xs:element ref="sup"/>
        <xs:element ref="textarea"/>
        <xs:element ref="time"/>
        <xs:element ref="u"/>
        <xs:element ref="var"/>
        <xs:element ref="wbr"/>
        <xs:element ref="mml:math"/>
        <xs:element ref="svg:svg"/>
      </xs:choice>
      <xs:attributeGroup ref="globals"/>
  </xs:complexType>
</xs:element>
  
<xs:element name="em" type="inlines_mml_and_svg"/>
  
<xs:element name="i" type="inlines_mml_and_svg"/>
  
<xs:element name="img">
  <xs:complexType>
    <xs:complexContent>
      <xs:extension base="empty_elem_global_attrs">
        <xs:attribute name="alt" type="xs:string"/>
        <xs:attribute name="usemap" type="hash_name"/>
        <!-- In HTML5 spec, "ismap" attr requires that img have an "a" ancestor with "href" attr, but we are not enforcing that restriction in Schema -->
        <xs:attribute name="ismap">
          <xs:simpleType>
            <xs:restriction base="xs:token">
              <xs:pattern value="([Ii][Ss][Mm][Aa][Pp])?"/>
            </xs:restriction>
          </xs:simpleType>
        </xs:attribute>
        <xs:attribute name="src" use="required" type="xs:anyURI"/>
        <xs:attribute name="width" type="xs:string"/>
        <xs:attribute name="height" type="xs:string"/>
      </xs:extension>
    </xs:complexContent>
  </xs:complexType>
</xs:element>
  
<xs:element name="input">
  <xs:complexType>
    <xs:complexContent>
      <xs:extension base="empty_elem_global_attrs">
        <xs:attribute name="accept" type="xs:NMTOKENS"/>
        <xs:attribute name="alt" type="xs:string"/>
        <xs:attribute name="autocomplete" type="on_off"/>
        <xs:attribute name="autofocus" type="autofocus_boolean"/>
        <xs:attribute name="checked" type="checked_boolean"/>
        <xs:attribute name="dirname" type="xs:string"/>
        <xs:attribute name="disabled" type="disabled_boolean"/>
        <!-- form attribute must refer to ID of a <form> element, but we're just checking that it's an IDREF -->
        <xs:attribute name="form" type="xs:IDREF"/>
        <xs:attribute name="formaction" type="xs:anyURI"/>
        <xs:attribute name="formenctype" type="enctype_formenctype"/>
        <xs:attribute name="formmethod" type="method_formmethod"/>
        <xs:attribute name="formnovalidate" type="formnovalidate_boolean"/>
        <xs:attribute name="formtarget" type="xs:string"/>
        <xs:attribute name="height" type="xs:string"/>
        <!-- "list" attr must refer to the id attr of a "datalist" element, but here we just check that it's an IDREF -->
        <xs:attribute name="list" type="xs:IDREF"/>
        <xs:attribute name="max" type="xs:string"/>
        <xs:attribute name="maxlength" type="positive_int"/>
        <xs:attribute name="min" type="xs:string"/>
        <xs:attribute name="multiple" type="multiple_boolean"/>        
        <xs:attribute name="name">
          <xs:simpleType>
            <xs:restriction base="xs:string">
              <xs:minLength value="1"/>
            </xs:restriction>
          </xs:simpleType>
        </xs:attribute>
        <xs:attribute name="pattern" type="xs:string"/>
        <xs:attribute name="placeholder" type="xs:string"/>
        <xs:attribute name="readonly" type="readonly_boolean"/>        
        <xs:attribute name="required" type="required_boolean"/>        
        <xs:attribute name="size" type="positive_int"/>
        <xs:attribute name="src" type="xs:anyURI"/>
        <xs:attribute name="step">
          <xs:simpleType>
            <xs:restriction base="xs:float">
              <xs:minExclusive value="0"/>
            </xs:restriction>
          </xs:simpleType>
        </xs:attribute>
        <xs:attribute name="type">
          <xs:simpleType>
            <xs:restriction base="xs:token">
              <xs:enumeration value="hidden"/>
              <xs:enumeration value="text"/>
              <xs:enumeration value="search"/>
              <xs:enumeration value="tel"/>
              <xs:enumeration value="url"/>
              <xs:enumeration value="email"/>
              <xs:enumeration value="password"/>
              <xs:enumeration value="datetime"/>
              <xs:enumeration value="date"/>
              <xs:enumeration value="month"/>
              <xs:enumeration value="week"/>
              <xs:enumeration value="time"/>
              <xs:enumeration value="datetime-local"/>
              <xs:enumeration value="number"/>
              <xs:enumeration value="range"/>
              <xs:enumeration value="color"/>
              <xs:enumeration value="checkbox"/>
              <xs:enumeration value="radio"/>
              <xs:enumeration value="file"/>
              <xs:enumeration value="submit"/>
              <xs:enumeration value="image"/>
              <xs:enumeration value="reset"/>
              <xs:enumeration value="button"/>
            </xs:restriction>
          </xs:simpleType>
        </xs:attribute>
        <xs:attribute name="value" type="xs:string"/>
        <xs:attribute name="width" type="xs:string"/>
      </xs:extension>
    </xs:complexContent>
  </xs:complexType>
</xs:element>
  
<!-- To simplify content model, "ins" element is only allowed in inline contexts in HTMLBook -->
<xs:element name="ins">
  <xs:complexType>
    <xs:complexContent>
      <xs:extension base="inlines_mml_and_svg">
        <xs:attribute name="cite" type="xs:anyURI"/>
        <xs:attribute name="datetime" type="xs:string"/>
      </xs:extension>
    </xs:complexContent>
  </xs:complexType>
</xs:element>

<xs:element name="kbd" type="inlines_mml_and_svg"/>

<xs:element name="keygen">
  <xs:complexType>
    <xs:complexContent>
      <xs:extension base="empty_elem_global_attrs">
        <xs:attribute name="autofocus" type="autofocus_boolean"/>
        <xs:attribute name="challenge" type="xs:string"/>
        <xs:attribute name="disabled" type="disabled_boolean"/>
        <!-- form attribute must refer to ID of a <form> element, but we're just checking that it's an IDREF -->
        <xs:attribute name="form" type="xs:IDREF"/>
        <xs:attribute name="keytype">
          <xs:simpleType>
            <xs:restriction base="xs:token">
              <!-- HTML5 spec indicates just one enumerated value -->
              <xs:enumeration value="rsa"/>
            </xs:restriction>
          </xs:simpleType>  
        </xs:attribute>
        <xs:attribute name="name" type="xs:string"/>
      </xs:extension>
    </xs:complexContent>
  </xs:complexType>
</xs:element>
  
<xs:element name="label">
  <!-- label elements can have any inline children, excluding another "label" element -->
  <xs:complexType mixed="true">
      <xs:choice minOccurs="0" maxOccurs="unbounded">
        <!-- Yeah we're enumerating all the inline options (from "inlineelements") here minus label, as there's no way to exclude just one item for a group,
             and I don't want to break up the "inlineelements" group below-->
        <xs:element ref="a"/>
        <xs:element ref="abbr"/>
        <xs:element ref="b"/>
        <xs:element ref="bdi"/>
        <xs:element ref="bdo"/>
        <xs:element ref="br"/>
        <xs:element ref="button"/>
        <xs:element ref="command"/>
        <xs:element ref="cite"/>
        <xs:element ref="code"/>
        <xs:element ref="datalist"/>
        <xs:element ref="del"/>
        <xs:element ref="dfn"/>
        <xs:element ref="em"/>
        <xs:element ref="i"/>
        <xs:element ref="img"/>
        <xs:element ref="input"/>
        <xs:element ref="ins"/>
        <xs:element ref="kbd"/>
        <xs:element ref="keygen"/>
        <xs:element ref="mark"/>  
        <xs:element ref="meter"/>
        <xs:element ref="output"/>
        <xs:element ref="progress"/>
        <xs:element ref="q"/>
        <xs:element ref="ruby"/>
        <xs:element ref="s"/>
        <xs:element ref="samp"/>
        <xs:element ref="select"/>
        <xs:element ref="small"/>
        <xs:element ref="span"/>
        <xs:element ref="strong"/>
        <xs:element ref="sub"/>
        <xs:element ref="sup"/>
        <xs:element ref="textarea"/>
        <xs:element ref="time"/>
        <xs:element ref="u"/>
        <xs:element ref="var"/>
        <xs:element ref="wbr"/>
        <xs:element ref="mml:math"/>
        <xs:element ref="svg:svg"/>
      </xs:choice>
      <xs:attribute name="for" type="xs:IDREF"/>
      <xs:attribute name="form" type="xs:IDREF"/>
      <xs:attributeGroup ref="globals"/>
  </xs:complexType>
</xs:element>
  
<xs:element name="mark" type="inlines_mml_and_svg"/>
  
<xs:element name="meter">
  <!-- meter elements can have any inline children, excluding another "meter" element -->
  <xs:complexType mixed="true">
      <xs:choice minOccurs="0" maxOccurs="unbounded">
        <!-- Yeah we're enumerating all the inline options (from "inlineelements") here minus meter, as there's no way to exclude just one item for a group,
             and I don't want to break up the "inlineelements" group below-->
        <xs:element ref="a"/>
        <xs:element ref="abbr"/>
        <xs:element ref="b"/>
        <xs:element ref="bdi"/>
        <xs:element ref="bdo"/>
        <xs:element ref="br"/>
        <xs:element ref="button"/>
        <xs:element ref="command"/>
        <xs:element ref="cite"/>
        <xs:element ref="code"/>
        <xs:element ref="datalist"/>
        <xs:element ref="del"/>
        <xs:element ref="dfn"/>
        <xs:element ref="em"/>
        <xs:element ref="i"/>
        <xs:element ref="img"/>
        <xs:element ref="input"/>
        <xs:element ref="ins"/>
        <xs:element ref="label"/>
        <xs:element ref="kbd"/>
        <xs:element ref="keygen"/>
        <xs:element ref="mark"/>
        <xs:element ref="output"/>
        <xs:element ref="progress"/>
        <xs:element ref="q"/>
        <xs:element ref="ruby"/>
        <xs:element ref="s"/>
        <xs:element ref="samp"/>
        <xs:element ref="select"/>
        <xs:element ref="small"/>
        <xs:element ref="span"/>
        <xs:element ref="strong"/>
        <xs:element ref="sub"/>
        <xs:element ref="sup"/>
        <xs:element ref="textarea"/>
        <xs:element ref="time"/>
        <xs:element ref="u"/>
        <xs:element ref="var"/>
        <xs:element ref="wbr"/>
        <xs:element ref="mml:math"/>
        <xs:element ref="svg:svg"/>
      </xs:choice>
      <xs:attribute name="form" type="xs:IDREF"/>
      <xs:attribute name="high" type="xs:float"/>
      <xs:attribute name="low" type="xs:float"/>
      <xs:attribute name="max" type="xs:float"/>
      <xs:attribute name="min" type="xs:float"/>
      <xs:attribute name="optimum" type="xs:float"/>
      <xs:attribute name="value" type="xs:float"/>
      <xs:attributeGroup ref="globals"/>
  </xs:complexType>
</xs:element>
  
<xs:element name="output">
  <xs:complexType mixed="true">
    <xs:complexContent>
      <xs:extension base="inlines_mml_and_svg">
        <!-- output element has a few additional attributes -->
        <xs:attribute name="for" type="xs:IDREF"/>
        <xs:attribute name="form" type="xs:IDREF"/>
        <xs:attribute name="name" type="nonemptystring"/>
      </xs:extension>
    </xs:complexContent>
  </xs:complexType>
</xs:element>
  
<xs:element name="progress">
  <!-- progress elements can have any inline children, excluding another "progress" element -->
  <xs:complexType mixed="true">
    <xs:choice minOccurs="0" maxOccurs="unbounded">
      <!-- Yeah we're enumerating all the inline options (from "inlineelements") here minus progress, as there's no way to exclude just one item for a group,
           and I don't want to break up the "inlineelements" group below-->
      <xs:element ref="a"/>
      <xs:element ref="abbr"/>
      <xs:element ref="b"/>
      <xs:element ref="bdi"/>
      <xs:element ref="bdo"/>
      <xs:element ref="br"/>
      <xs:element ref="button"/>
      <xs:element ref="command"/>
      <xs:element ref="cite"/>
      <xs:element ref="code"/>
      <xs:element ref="datalist"/>
      <xs:element ref="del"/>
      <xs:element ref="dfn"/>
      <xs:element ref="em"/>
      <xs:element ref="i"/>
      <xs:element ref="img"/>
      <xs:element ref="input"/>
      <xs:element ref="ins"/>
      <xs:element ref="label"/>
      <xs:element ref="kbd"/>
      <xs:element ref="keygen"/>
      <xs:element ref="mark"/>
      <xs:element ref="meter"/>
      <xs:element ref="output"/>
      <xs:element ref="q"/>
      <xs:element ref="ruby"/>
      <xs:element ref="s"/>
      <xs:element ref="samp"/>
      <xs:element ref="select"/>
      <xs:element ref="small"/>
      <xs:element ref="span"/>
      <xs:element ref="strong"/>
      <xs:element ref="sub"/>
      <xs:element ref="sup"/>
      <xs:element ref="textarea"/>
      <xs:element ref="time"/>
      <xs:element ref="u"/>
      <xs:element ref="var"/>
      <xs:element ref="wbr"/>
      <xs:element ref="mml:math"/>
      <xs:element ref="svg:svg"/>
    </xs:choice>
    <xs:attribute name="form" type="xs:IDREF"/>
    <xs:attribute name="max" type="xs:float"/>
    <xs:attribute name="value" type="xs:float"/>
    <xs:attributeGroup ref="globals"/>
  </xs:complexType>
</xs:element>

<xs:element name="q">
  <xs:complexType mixed="true">
    <xs:complexContent>
      <xs:extension base="inlines_mml_and_svg">
        <xs:attribute name="cite" type="xs:anyURI"/>
      </xs:extension>
    </xs:complexContent>
  </xs:complexType>
</xs:element>
  
<xs:element name="ruby">
  <xs:complexType mixed="true">
    <xs:complexContent>
      <xs:extension base="inlines_mml_and_svg">
          <xs:choice>
            <xs:element ref="rt"/>
            <xs:sequence>
              <xs:element ref="rp"/>
              <xs:element ref="rt"/>
              <xs:element ref="rp"/>
            </xs:sequence>
          </xs:choice>
      </xs:extension>
    </xs:complexContent>
  </xs:complexType>
</xs:element>
  
<xs:element name="s" type="inlines_mml_and_svg"/>
  
<xs:element name="samp" type="inlines_mml_and_svg"/>

<xs:element name="select">
  <xs:complexType>
    <xs:choice>
      <xs:element ref="option" minOccurs="0" maxOccurs="unbounded"/>
      <xs:element ref="optgroup" minOccurs="0" maxOccurs="unbounded"/>
    </xs:choice>
    <xs:attribute name="autofocus" type="autofocus_boolean"/>
    <xs:attribute name="disabled" type="disabled_boolean"/>
    <!-- form attribute must refer to ID of a <form> element, but we're just checking that it's an IDREF -->
    <xs:attribute name="form" type="xs:IDREF"/>
    <xs:attribute name="multiple" type="multiple_boolean"/>
    <xs:attribute name="name">
      <xs:simpleType>
        <xs:restriction base="xs:string">
          <xs:minLength value="1"/>
        </xs:restriction>
      </xs:simpleType>
    </xs:attribute>
    <xs:attribute name="required" type="required_boolean"/>
    <xs:attribute name="size" type="positive_int"/>
    <xs:attributeGroup ref="globals"/>
  </xs:complexType>
</xs:element>
  
<xs:element name="small" type="inlines_mml_and_svg"/>
  
<xs:element name="span" type="inlines_mml_and_svg"/>
  
<xs:element name="strong" type="inlines_mml_and_svg"/>
  
<xs:element name="sub" type="inlines_mml_and_svg"/>
  
<xs:element name="sup" type="inlines_mml_and_svg"/>
  
<xs:element name="textarea">
  <xs:complexType mixed="true">
    <xs:attribute name="autofocus" type="autofocus_boolean"/>
    <xs:attribute name="cols" type="positive_int"/>
    <xs:attribute name="dirname" type="xs:string"/>
    <xs:attribute name="disabled" type="disabled_boolean"/>
    <!-- form attribute must refer to ID of a <form> element, but we're just checking that it's an IDREF -->
    <xs:attribute name="form" type="xs:IDREF"/>
    <xs:attribute name="maxlength" type="positive_int"/>
    <xs:attribute name="name">
      <xs:simpleType>
        <xs:restriction base="xs:string">
          <xs:minLength value="1"/>
        </xs:restriction>
      </xs:simpleType>
    </xs:attribute>
    <xs:attribute name="placeholder" type="xs:string"/>
    <xs:attribute name="readonly" type="readonly_boolean"/>
    <xs:attribute name="required" type="required_boolean"/>
    <xs:attribute name="rows" type="positive_int"/>
    <xs:attribute name="wrap">
      <xs:simpleType>
        <xs:restriction base="xs:token">
          <xs:enumeration value="soft"/>
          <xs:enumeration value="hard"/>
        </xs:restriction>
      </xs:simpleType>
    </xs:attribute>
    <xs:attributeGroup ref="globals"/>
  </xs:complexType>
</xs:element>
  
<xs:element name="time">
  <!-- time elements can have any inline children, excluding another "time" element -->
  <xs:complexType mixed="true">
    <xs:choice minOccurs="0" maxOccurs="unbounded">
      <!-- Yeah we're enumerating all the inline options (from "inlineelements") here minus time, as there's no way to exclude just one item for a group,
           and I don't want to break up the "inlineelements" group below-->
      <xs:element ref="a"/>
      <xs:element ref="abbr"/>
      <xs:element ref="b"/>
      <xs:element ref="bdi"/>
      <xs:element ref="bdo"/>
      <xs:element ref="br"/>
      <xs:element ref="button"/>
      <xs:element ref="command"/>
      <xs:element ref="cite"/>
      <xs:element ref="code"/>
      <xs:element ref="datalist"/>
      <xs:element ref="del"/>
      <xs:element ref="dfn"/>
      <xs:element ref="em"/>
      <xs:element ref="i"/>
      <xs:element ref="img"/>
      <xs:element ref="input"/>
      <xs:element ref="ins"/>
      <xs:element ref="label"/>
      <xs:element ref="kbd"/>
      <xs:element ref="keygen"/>
      <xs:element ref="mark"/>
      <xs:element ref="meter"/>
      <xs:element ref="output"/>
      <xs:element ref="progress"/>
      <xs:element ref="q"/>
      <xs:element ref="ruby"/>
      <xs:element ref="s"/>
      <xs:element ref="samp"/>
      <xs:element ref="select"/>
      <xs:element ref="small"/>
      <xs:element ref="span"/>
      <xs:element ref="strong"/>
      <xs:element ref="sub"/>
      <xs:element ref="sup"/>
      <xs:element ref="textarea"/>
      <xs:element ref="u"/>
      <xs:element ref="var"/>
      <xs:element ref="wbr"/>
      <xs:element ref="mml:math"/>
      <xs:element ref="svg:svg"/>
    </xs:choice>
    <xs:attribute name="pubdate">
      <xs:simpleType>
        <xs:restriction base="xs:string">
          <xs:pattern value="([Pp][Uu][Bb][Dd][Aa][Tt][Ee])?"/>
        </xs:restriction>
      </xs:simpleType>
    </xs:attribute>
    <xs:attribute name="datetime" type="xs:string"/>
    <xs:attributeGroup ref="globals"/>
  </xs:complexType>
</xs:element>
  
<xs:element name="u" type="inlines_mml_and_svg"/>
  
<xs:element name="var" type="inlines_mml_and_svg"/>
  
<xs:element name="wbr" type="empty_elem_global_attrs"/>
    
<!-- Miscellaneous elements -->
<xs:element name="area">
  <xs:complexType>
    <xs:complexContent>
      <xs:extension base="empty_elem_global_attrs">
        <xs:attribute name="alt" type="xs:string"/>
        <xs:attribute name="coords">
          <xs:simpleType>
            <xs:restriction base="xs:string">
              <!-- Regex for string of comma-separated numbers -->
              <!-- Yes, this'll match a string that ends in a comma,
                   but close enough for validation purposes, given that XML Schema doesn't support lookaheads -->
              <xs:pattern value="[0-9][0-9,]*"/>
            </xs:restriction>
          </xs:simpleType>
        </xs:attribute>
        <xs:attribute name="shape">
          <xs:simpleType>
            <xs:restriction base="xs:token">
              <xs:enumeration value="circle"/>
              <xs:enumeration value="circ"/>
              <xs:enumeration value="default"/>
              <xs:enumeration value="poly"/>
              <xs:enumeration value="polygon"/>
              <xs:enumeration value="rect"/>
              <xs:enumeration value="rectangle"/>
            </xs:restriction>
          </xs:simpleType>
        </xs:attribute>
        <xs:attribute name="href" type="xs:anyURI"/>
        <xs:attribute name="target" type="xs:string"/>
        <xs:attribute name="rel">
          <xs:simpleType>
            <xs:restriction base="xs:string">
              <!-- Ugly regex alert -->
              <xs:pattern value="(alternate|author|bookmark|external|help|icon|license|next|nofollow|noreferrer|pingback|prefetch|prev|search|sidebar|stylesheet|tag)( (alternate|author|bookmark|external|help|icon|license|next|nofollow|noreferrer|pingback|prefetch|prev|search|sidebar|stylesheet|tag))*"/>
            </xs:restriction>
          </xs:simpleType>
        </xs:attribute>
        <xs:attribute name="media" type="xs:string"/>
        <xs:attribute name="hreflang" type="xs:language"/>
        <xs:attribute name="type" type="xs:string"/>
      </xs:extension>
    </xs:complexContent>
  </xs:complexType>
</xs:element>
  
<xs:element name="caption" type="caption"/>
  
<xs:element name="col">
  <xs:complexType>
    <xs:complexContent>
      <xs:extension base="empty_elem_global_attrs">
        <xs:attribute name="span" type="xs:int"/>
      </xs:extension>
    </xs:complexContent>
  </xs:complexType>
</xs:element>
  
<xs:element name="colgroup">
  <!-- Technically, colgroup requires an either/or situation, where if there is a span attribute, there should be no <col> children.
       Not possible to represent this in XML Schema -->
  <xs:complexType>
    <xs:sequence>
      <xs:element ref="col" minOccurs="0" maxOccurs="unbounded"/>
    </xs:sequence>
    <xs:attribute name="span" type="xs:int"/>
    <xs:attributeGroup ref="globals"/>
  </xs:complexType>
</xs:element>
  
<xs:element name="dd" type="block_xor_inline_children"/>

<xs:element name="dt" type="inlines_mml_and_svg"/>

<xs:element name="figcaption" type="caption"/>
  
<xs:element name="legend" type="inlines_mml_and_svg"/>
  
<xs:element name="li" type="block_xor_inline_children"/>
  
<xs:element name="optgroup">
  <xs:complexType>
    <xs:sequence>
      <xs:element ref="option" minOccurs="0" maxOccurs="unbounded"/>
    </xs:sequence>
    <xs:attribute name="disabled" type="disabled_boolean"/>
    <xs:attribute name="label" type="xs:string" use="required"/>
    <xs:attributeGroup ref="globals"/>
  </xs:complexType>
</xs:element>
  
<xs:element name="option">
  <xs:complexType mixed="true">
    <xs:complexContent>
      <xs:extension base="empty_elem_global_attrs">
        <xs:attribute name="disabled" type="disabled_boolean"/>        
        <xs:attribute name="label" type="xs:string"/>
        <xs:attribute name="selected">
          <xs:simpleType>
            <xs:restriction base="xs:token">
              <xs:pattern value="([Ss][Ee][Ll][Ee][Cc][Tt][Ee][Dd])?"/>
            </xs:restriction>
          </xs:simpleType>
        </xs:attribute>
        <xs:attribute name="value" type="xs:string"/>
      </xs:extension>
    </xs:complexContent>
  </xs:complexType>
</xs:element>
  
<xs:element name="param">
  <xs:complexType>
    <xs:complexContent>
      <xs:extension base="empty_elem_global_attrs">
        <xs:attribute name="name" type="xs:string" use="required"/>
        <xs:attribute name="value" type="xs:string" use="required"/>        
      </xs:extension>
    </xs:complexContent>
  </xs:complexType>
</xs:element>
  
<xs:element name="rp" type="inlines_mml_and_svg"/>
  
<xs:element name="rt" type="inlines_mml_and_svg"/>
  
<xs:element name="source">
  <xs:complexType>
    <xs:complexContent>
      <xs:extension base="empty_elem_global_attrs">
        <xs:attribute name="media" type="xs:string"/>
        <xs:attribute name="src" type="xs:anyURI" use="required"/>
        <xs:attribute name="type" type="xs:string"/>
      </xs:extension>
    </xs:complexContent>
  </xs:complexType>  
</xs:element>

<xs:element name="summary" type="inlines_mml_and_svg"/>
  
<xs:element name="tbody" type="tablegrouping"/>
  
<xs:element name="td">
  <xs:complexType>
    <xs:complexContent>
      <xs:extension base="block_xor_inline_children">
        <xs:attributeGroup ref="tablecellattributes"/>
      </xs:extension>
    </xs:complexContent>
  </xs:complexType>
</xs:element>
  
<xs:element name="th">
  <xs:complexType>
    <xs:complexContent>
      <xs:extension base="inlines_mml_and_svg">
        <xs:attributeGroup ref="tablecellattributes"/>
        <xs:attribute name="scope">
          <xs:simpleType>
            <xs:restriction base="xs:token">
              <xs:enumeration value="auto"/>
              <xs:enumeration value="col"/>
              <xs:enumeration value="colgroup"/>
              <xs:enumeration value="row"/>
              <xs:enumeration value="rowgroup"/>
            </xs:restriction>
          </xs:simpleType>
        </xs:attribute>
      </xs:extension>
    </xs:complexContent>
  </xs:complexType>
</xs:element>

<xs:element name="thead" type="tablegrouping"/>
  
<xs:element name="tfoot" type="tablegrouping"/>
  
<xs:element name="tr">
  <xs:complexType>
    <xs:group ref="table_cells" minOccurs="0" maxOccurs="unbounded"/>
    <xs:attributeGroup ref="globals"/>
  </xs:complexType>
</xs:element>
  
<xs:element name="track">
  <xs:complexType>
    <xs:complexContent>
      <xs:extension base="empty_elem_global_attrs">
        <xs:attribute name="default">
          <xs:simpleType>
            <xs:restriction base="xs:token">
              <xs:pattern value="([Dd][Ee][Ff][Aa][Uu][Ll][Tt])?"/>
            </xs:restriction>
          </xs:simpleType>
        </xs:attribute>
        <xs:attribute name="kind">
          <xs:simpleType>
            <xs:restriction base="xs:token">
              <xs:enumeration value="captions"/>
              <xs:enumeration value="chapters"/>
              <xs:enumeration value="descriptions"/>
              <xs:enumeration value="metadata"/>
              <xs:enumeration value="subtitles"/>
            </xs:restriction>
          </xs:simpleType>
        </xs:attribute>
        <xs:attribute name="label" type="xs:string"/>
        <xs:attribute name="src" type="xs:anyURI"/>
        <xs:attribute name="srclang" type="xs:language"/>
      </xs:extension>
    </xs:complexContent>
  </xs:complexType>
</xs:element>

<!-- Heading elements -->
<xs:element name="h1" type="inlines_mml_and_svg"/>

<xs:element name="h2" type="inlines_mml_and_svg"/>

<xs:element name="h3" type="inlines_mml_and_svg"/>
  
<xs:element name="h4" type="inlines_mml_and_svg"/>
  
<xs:element name="h5" type="inlines_mml_and_svg"/>
  
<xs:element name="h6" type="inlines_mml_and_svg"/>
  
  
<!-- Global simple type definitions; see also global complex types section -->

<!-- For data-type attribute on book division <sections>, except part -->
<xs:simpleType name="bookmaindivtype">
  <xs:restriction base="xs:string">
    <xs:enumeration value="acknowledgments"/>
    <xs:enumeration value="afterword"/>
    <xs:enumeration value="appendix"/>
    <xs:enumeration value="bibliography"/>
    <xs:enumeration value="chapter"/>
    <xs:enumeration value="colophon"/>
    <xs:enumeration value="conclusion"/>
    <xs:enumeration value="copyright-page"/>
    <xs:enumeration value="dedication"/>
    <xs:enumeration value="foreword"/>
    <xs:enumeration value="glossary"/>
    <xs:enumeration value="halftitlepage"/>
    <xs:enumeration value="index"/>
    <xs:enumeration value="introduction"/>
    <xs:enumeration value="preface"/>
    <xs:enumeration value="titlepage"/>
    <xs:enumeration value="toc"/>
  </xs:restriction>
</xs:simpleType>
  
<!-- Used for attributes that require a nonempty string (e.g., "name" attribute on <output> -->
<xs:simpleType name="nonemptystring">
  <xs:restriction base="xs:string">
    <xs:pattern value=".+"/>
  </xs:restriction>
</xs:simpleType>
  
<!-- Used for positive integers -->
<xs:simpleType name="positive_int">
  <xs:restriction base="xs:integer">
    <xs:minExclusive value="0"/>
  </xs:restriction>
</xs:simpleType>
  
<!-- For types of subheadings: subtitle, author attributions, etc. -->
<!-- ToDo: Add additional types as required -->
<xs:simpleType name="subheadingtype">
  <xs:restriction base="xs:string">
    <xs:enumeration value="subtitle"/>
    <xs:enumeration value="author"/>
  </xs:restriction>
</xs:simpleType>
  
<!-- Restrict boolean type to only allow "true", "false", or empty string -->
<xs:simpleType name="true_false">
  <xs:restriction base="xs:token">
    <xs:enumeration value="true"/>
    <xs:enumeration value="false"/>
    <xs:enumeration value=""/>
  </xs:restriction>
</xs:simpleType>
  
<!-- For attributes enumerated as on/off (e.g., autocomplete) -->
<xs:simpleType name="on_off">
  <xs:restriction base="xs:token">
    <xs:enumeration value="on"/>
    <xs:enumeration value="off"/>
  </xs:restriction>
</xs:simpleType>
  
<!--- autofocus boolean -->
<xs:simpleType name="autofocus_boolean">
  <xs:restriction base="xs:token">
    <xs:pattern value="([Aa][Uu][Tt][Oo][Ff][Oo][Cc][Uu][Ss])?"/>
  </xs:restriction>
</xs:simpleType>
  
<!-- checked boolean -->
<xs:simpleType name="checked_boolean">
  <xs:restriction base="xs:token">
    <xs:pattern value="([Cc][Hh][Ee][Cc][Kk][Ee][Dd])?"/>
  </xs:restriction>
</xs:simpleType>
  
<!-- disabled boolean -->
<xs:simpleType name="disabled_boolean">
  <xs:restriction base="xs:token">
    <xs:pattern value="([Dd][Ii][Ss][Aa][Bb][Ll][Ee][Dd])?"/>
  </xs:restriction>
</xs:simpleType>
  
<!-- formnovalidate boolean -->
<xs:simpleType name="formnovalidate_boolean">
  <xs:restriction base="xs:token">
    <xs:pattern value="([Ff][Oo][Rr][Mm][Nn][Oo][Vv][Aa][Ll][Ii][Dd][Aa][Tt][Ee])?"/>
  </xs:restriction>
</xs:simpleType>
  
<!-- multiple boolean -->
<xs:simpleType name="multiple_boolean">
  <xs:restriction base="xs:token">
    <xs:pattern value="([Mm][Uu][Ll][Tt][Ii][Pp][Ll][Ee])?"/>
  </xs:restriction>
</xs:simpleType>
 
<!-- readonly boolean -->
<xs:simpleType name="readonly_boolean">
  <xs:restriction base="xs:token">
    <xs:pattern value="([Rr][Ee][Aa][Dd][Oo][Nn][Ll][Yy])?"/>
  </xs:restriction>
</xs:simpleType>
  
<!-- required boolean -->
<xs:simpleType name="required_boolean">
  <xs:restriction base="xs:token">
    <xs:pattern value="([Rr][Ee][Qq][Uu][Ii][Rr][Ee][Dd])?"/>
  </xs:restriction>
</xs:simpleType>  
  
<!-- for enctype/formenctype attributes used on form elements -->
<xs:simpleType name="enctype_formenctype">
  <xs:restriction base="xs:string">
    <xs:enumeration value="application/x-www-form-urlencoded"/>
    <xs:enumeration value="multipart/form-data"/>
    <xs:enumeration value="text/plain"/>
  </xs:restriction>
</xs:simpleType>
  
<!-- for method/formmethod attributes used on form elements -->
<xs:simpleType name="method_formmethod">
  <xs:restriction base="xs:token">
    <xs:enumeration value="get"/>
    <xs:enumeration value="post"/>
  </xs:restriction>
</xs:simpleType>
  
<!-- For hash-name references; we're just checking that string starts with #, not that the reference is actually there -->
<xs:simpleType name="hash_name">
  <xs:restriction base="xs:string">
    <xs:pattern value="#.+"/>
  </xs:restriction>
</xs:simpleType>
 
<!-- Global complex type definitions; see also global simple types section-->

<!-- Chapter/Appendix/Preface/etc. -->
<xs:complexType name="bookmaindiv">
  <xs:sequence>
    <xs:choice>
      <xs:element ref="h1"/>
      <xs:element name="header" type="bookmainheader"/>
    </xs:choice>
    <!-- Allow full set of block elements plus img elements in chapter-level sections -->
    <xs:group ref="figure_elements" minOccurs="0" maxOccurs="unbounded"/>
    <xs:element name="section" minOccurs="0" maxOccurs="unbounded" type="sect1"/>
  </xs:sequence>
  <!-- Note: special data-type attr restrictions here -->
  <xs:attribute name="data-type" use="required" type="bookmaindivtype"/>
  <xs:attributeGroup ref="globals"/>
</xs:complexType>

<!-- Parts -->
<xs:complexType name="bookpart">
  <xs:sequence>
    <xs:choice>
      <xs:element ref="h1"/>
      <xs:element name="header" type="bookmainheader"/>
    </xs:choice>
    <!-- Allow full set of block elements plus img elements in part divs -->
    <xs:group ref="figure_elements" minOccurs="0" maxOccurs="unbounded"/>
    <xs:element name="section" maxOccurs="unbounded" type="bookmaindiv"/>
  </xs:sequence>
  <!-- Note: special data-type attr restrictions here -->
  <xs:attribute name="data-type" use="required" fixed="part"/>
  <xs:attributeGroup ref="globals"/>
</xs:complexType>
  
<!-- Sect1s -->
<xs:complexType name="sect1">
  <xs:sequence>
    <xs:choice>
      <xs:element ref="h1"/>
      <xs:element name="header" type="bookmainheader"/>
    </xs:choice>
    <!-- Allow full set of block elements plus img elements in sect1s -->
    <xs:group ref="figure_elements" minOccurs="0" maxOccurs="unbounded"/>
    <xs:element name="section" minOccurs="0" maxOccurs="unbounded" type="sect2"/>
  </xs:sequence>
  <!-- Note: special data-type attr restrictions here -->
  <xs:attribute name="data-type" use="required" fixed="sect1"/>
  <xs:attributeGroup ref="globals"/>
</xs:complexType>

<!-- Sect2s -->
<xs:complexType name="sect2">
  <xs:sequence>
    <xs:choice>
      <xs:element ref="h2"/>
      <xs:element name="header" type="booksect2header"/>
    </xs:choice>
    <!-- Allow full set of block elements plus img elements in sect2s -->
    <xs:group ref="figure_elements" minOccurs="0" maxOccurs="unbounded"/>
    <xs:element name="section" minOccurs="0" maxOccurs="unbounded" type="sect3"/>
  </xs:sequence>
  <!-- Note: special data-type attr restrictions here -->
  <xs:attribute name="data-type" use="required" fixed="sect2"/>
  <xs:attributeGroup ref="globals"/>
</xs:complexType>
  
<!-- Sect3s -->
<xs:complexType name="sect3">
  <xs:sequence>
    <xs:choice>
      <xs:element ref="h3"/>
      <xs:element name="header" type="booksect3header"/>
    </xs:choice>
    <!-- Allow full set of block elements plus img elements in sect3s -->
    <xs:group ref="figure_elements" minOccurs="0" maxOccurs="unbounded"/>
    <xs:element name="section" minOccurs="0" maxOccurs="unbounded" type="sect4"/>
  </xs:sequence>
  <!-- Note: special data-type attr restrictions here -->
  <xs:attribute name="data-type" use="required" fixed="sect3"/>
  <xs:attributeGroup ref="globals"/>
</xs:complexType>
  
<!-- Sect4s -->
<xs:complexType name="sect4">
  <xs:sequence>
    <xs:choice>
      <xs:element ref="h4"/>
      <xs:element name="header" type="booksect4header"/>
    </xs:choice>
    <!-- Allow full set of block elements plus img elements in sect4s -->
    <xs:group ref="figure_elements" minOccurs="0" maxOccurs="unbounded"/>
    <xs:element name="section" minOccurs="0" maxOccurs="unbounded" type="sect5"/>
  </xs:sequence>
  <!-- Note: special data-type attr restrictions here -->
  <xs:attribute name="data-type" use="required" fixed="sect4"/>
  <xs:attributeGroup ref="globals"/>
</xs:complexType>
  
<!-- Sect5 -->
<xs:complexType name="sect5">
  <xs:sequence>
    <xs:choice>
      <xs:element ref="h5"/>
      <xs:element name="header" type="booksect5header"/>
    </xs:choice>
    <!-- Allow full set of block elements plus img elements in sect5s -->
    <xs:group ref="figure_elements" minOccurs="0" maxOccurs="unbounded"/>
  </xs:sequence>
  <!-- Note: special data-type attr restrictions here -->
  <xs:attribute name="data-type" use="required" fixed="sect5"/>
  <xs:attributeGroup ref="globals"/>
</xs:complexType>
  
<!-- Sidebar; primarily for <aside> -->
<xs:complexType name="sidebar">
  <xs:sequence>
    <xs:element ref="h5" minOccurs="0"/> <!-- Unlike other sections, sidebar titles are optional -->
    <xs:group ref="figure_elements" minOccurs="0" maxOccurs="unbounded"/>
  </xs:sequence>
  <!-- ToDo: require data-type attr restriction of "sidebar" here? -->
  <xs:attributeGroup ref="globals"/>
</xs:complexType>
  
<!-- Header blocks (used for title+subtitle) -->
  
<!-- Header for top-level blocks and top-level sections (part, chapter, sect1s) -->
<xs:complexType name="bookmainheader">
  <xs:sequence>
    <xs:element ref="h1"/>
    <xs:element name="p" type="subheading" minOccurs="0" maxOccurs="unbounded"/>
  </xs:sequence>
</xs:complexType>

<!-- Header block for sect2s -->
<xs:complexType name="booksect2header">
  <xs:sequence>
    <xs:element ref="h2"/>
    <xs:element name="p" type="subheading" minOccurs="0" maxOccurs="unbounded"/>
  </xs:sequence>
</xs:complexType>
  
<!-- Header block for sect3s -->
<xs:complexType name="booksect3header">
  <xs:sequence>
    <xs:element ref="h3"/>
    <xs:element name="p" type="subheading" minOccurs="0" maxOccurs="unbounded"/>
  </xs:sequence>
</xs:complexType>
  
<!-- Header block for sect4s -->
<xs:complexType name="booksect4header">
  <xs:sequence>
    <xs:element ref="h4"/>
    <xs:element name="p" type="subheading" minOccurs="0" maxOccurs="unbounded"/>
  </xs:sequence>
</xs:complexType>
  
<!-- Header block for sect5s -->
<xs:complexType name="booksect5header">
  <xs:sequence>
    <xs:element ref="h5"/>
    <xs:element name="p" type="subheading" minOccurs="0" maxOccurs="unbounded"/>
  </xs:sequence>
</xs:complexType>
  
<!-- Subheadings: support subtitles, author attributions, etc. -->
<!-- ToDo: Continue to flesh out as necessary -->
<xs:complexType name="subheading" mixed="true">
  <xs:sequence>
    <xs:group ref="inlines_plus_mml_and_svg" minOccurs="0" maxOccurs="unbounded"/>
  </xs:sequence>
  <!-- Note: special data-type attr restrictions here -->
  <xs:attribute name="data-type" use="required" type="subheadingtype"/>
  <xs:attributeGroup ref="globals"/>
</xs:complexType>
 
<!-- Custom types for Nav Document (following EPUB 3 spec; see http://www.idpf.org/epub/30/spec/epub30-contentdocs.html#sec-xhtml-nav) -->
<xs:complexType name="nav_doc_ol">
  <xs:sequence>
    <xs:element name="li" type="nav_doc_li" minOccurs="0" maxOccurs="unbounded"/>
  </xs:sequence>
  <xs:attributeGroup ref="ol_attrs"/>
  <xs:attributeGroup ref="globals"/>
</xs:complexType>
  
<xs:complexType name="nav_doc_li" mixed="true">
  <xs:choice>
    <xs:element ref="span"/>
    <xs:sequence>
      <xs:element ref="a"/>
      <xs:element name="ol" minOccurs="0" type="nav_doc_ol"/>
    </xs:sequence>
  </xs:choice>
  <xs:attributeGroup ref="globals"/>
</xs:complexType>
  
<!-- General handling for elements that can accept only inline children -->
<xs:complexType name="inlines_mml_and_svg" mixed="true">
  <xs:sequence>
    <xs:group ref="inlines_plus_mml_and_svg" minOccurs="0" maxOccurs="unbounded"/>
  </xs:sequence>
  <xs:attributeGroup ref="globals"/>
</xs:complexType>
  
<!-- General handling for elements that can accept either block children or inline children (not both)-->
<xs:complexType name="block_xor_inline_children" mixed="true">
  <xs:choice>
    <xs:group ref="blockelements" minOccurs="0" maxOccurs="unbounded"/>
    <xs:group ref="inlineelements" minOccurs="0" maxOccurs="unbounded"/>
  </xs:choice>
  <xs:attributeGroup ref="globals"/>
</xs:complexType>

<!-- Type for no restrictions on child content -->
<xs:complexType name="any_elems_attrs" mixed="true">
  <xs:sequence minOccurs="0" maxOccurs="unbounded">
    <xs:any processContents="lax"/>
  </xs:sequence>
  <xs:attributeGroup ref="globals"/>
</xs:complexType>
  
<!-- Type for empty element, with no specific attribute requirements -->
<xs:complexType name="empty_elem_global_attrs">
  <xs:attributeGroup ref="globals"/>
</xs:complexType>

<!-- Type for figure/table captions -->
<xs:complexType name="caption" mixed="true">
  <!-- Subset of block elements (<p>s or <div>s) xor inline elements-->
  <xs:choice>
    <xs:choice minOccurs="0" maxOccurs="unbounded">
      <xs:element ref="p"/>
      <xs:element ref="div"/>
    </xs:choice>
    <xs:group ref="inlines_plus_mml_and_svg" minOccurs="0" maxOccurs="unbounded"/>
  </xs:choice>
  <xs:attributeGroup ref="globals"/>
</xs:complexType>
  
<!-- Type for table group blocks: thead, tbody, and tfoot -->
<xs:complexType name="tablegrouping">
  <xs:sequence>
    <xs:element ref="tr" minOccurs="0" maxOccurs="unbounded"/>
  </xs:sequence>
  <xs:attributeGroup ref="globals"/>
</xs:complexType>
  
<!-- Global groups -->
  
<xs:group name="blockelements">
  <!-- We're defining "block elements" here as a subset of HTML5 flow content that can be children of a <section> -->
  <xs:choice>
    <xs:element ref="address"/>
    <xs:element ref="aside"/>
    <xs:element ref="audio"/>
    <xs:element ref="blockquote"/>
    <xs:element ref="canvas"/>
    <xs:element ref="details"/>
    <xs:element ref="div"/>
    <xs:element ref="dl"/>
    <xs:element ref="embed"/>
    <xs:element ref="fieldset"/>
    <xs:element ref="figure"/>
    <xs:element ref="form"/>
    <xs:element ref="hr"/>
    <xs:element ref="iframe"/>
    <xs:element ref="map"/>
    <xs:element ref="menu"/>
    <xs:element ref="object"/>
    <xs:element ref="ol"/>
    <xs:element ref="p"/>
    <xs:element ref="pre"/>
    <xs:element ref="table"/>
    <xs:element ref="ul"/>
    <xs:element ref="video"/>
    <xs:group ref="external_elements"/>
  </xs:choice>
</xs:group>

<!-- Elements from other vocabularies that can be included in HTML5: MathML and SVG -->
<xs:group name="external_elements">
  <xs:choice>
    <xs:element ref="mml:math"/>
    <xs:element ref="svg:svg"/>
  </xs:choice>
</xs:group>

<!-- Elements that can go in a figure = block elements + img -->
<xs:group name="figure_elements">
  <xs:choice>
    <xs:group ref="blockelements"/>
    <xs:element ref="img"/>
  </xs:choice>
</xs:group>
  
<!-- Elements that can go in a map = block elements + area -->
<xs:group name="map_elements">
  <xs:choice>
    <xs:group ref="blockelements"/>
    <xs:element ref="area"/>
  </xs:choice>
</xs:group>
    
<xs:group name="headings">
  <xs:choice>
    <xs:element ref="h1"/>
    <xs:element ref="h2"/>
    <xs:element ref="h3"/>
    <xs:element ref="h4"/>
    <xs:element ref="h5"/>
    <xs:element ref="h6"/>
  </xs:choice>
</xs:group>
  
<xs:group name="inlineelements">
<!-- We're defining "inline elements" here as being generally equivalent to the set of HTML5 phrasing elements: 
     those that can be children of a block element.
     These are elements that can be used *solely in an inline context* Elements that can be either inline or block 
     (e.g., <math> and <svg>) are not covered) -->
  <xs:choice>
    <xs:element ref="a"/>
    <xs:element ref="abbr"/>
    <xs:element ref="b"/>
    <xs:element ref="bdi"/>
    <xs:element ref="bdo"/>
    <xs:element ref="br"/>
    <xs:element ref="button"/>
    <xs:element ref="command"/>
    <xs:element ref="cite"/>
    <xs:element ref="code"/>
    <xs:element ref="datalist"/>
    <xs:element ref="del"/>
    <xs:element ref="dfn"/>
    <xs:element ref="em"/>
    <xs:element ref="i"/>
    <xs:element ref="input"/>
    <xs:element ref="img"/>
    <xs:element ref="ins"/>
    <xs:element ref="kbd"/>
    <xs:element ref="keygen"/>  
    <xs:element ref="label"/>  
    <xs:element ref="mark"/>  
    <xs:element ref="meter"/>
    <xs:element ref="output"/>
    <xs:element ref="progress"/>
    <xs:element ref="q"/>
    <xs:element ref="ruby"/>
    <xs:element ref="s"/>
    <xs:element ref="samp"/>
    <xs:element ref="select"/>
    <xs:element ref="small"/>
    <xs:element ref="span"/>
    <xs:element ref="strong"/>
    <xs:element ref="sub"/>
    <xs:element ref="sup"/>
    <xs:element ref="textarea"/>
    <xs:element ref="time"/>
    <xs:element ref="u"/>
    <xs:element ref="var"/>
    <xs:element ref="wbr"/>
  </xs:choice>
</xs:group>
  
<xs:group name="inlines_plus_mml_and_svg">
  <xs:choice>
    <xs:group ref="inlineelements"/>
    <xs:group ref="external_elements"/>
  </xs:choice>
</xs:group>

<xs:group name="table_cells">
  <xs:choice>
    <xs:element ref="th"/>
    <xs:element ref="td"/>
  </xs:choice>
</xs:group>
  
<!-- Global attribute groups -->
<!-- ToDo: Go ahead and add group for global HTML5 attributes (with exception of data- attrs),
      or just leave the xs:anyAttribute declarations to catch these? (If this is done, remove all the xs:attribute declarations for "id")-->

<!-- All globals except "dir", which is separated out because other elements have their own 'dir' requirements -->
<xs:attributeGroup name="globals_minus_dir">
  <xs:attribute name="accesskey">
    <xs:simpleType>
      <xs:restriction base="xs:NMTOKENS">
        <xs:pattern value="[^ ]( [^ ])*"/>
      </xs:restriction>
    </xs:simpleType>
  </xs:attribute>
  <xs:attribute name="class" type="xs:NMTOKENS"/>
  <xs:attribute name="contenteditable" type="true_false"/>
  <xs:attribute name="contextmenu" type="xs:IDREF"/>
  <xs:attribute name="draggable" type="true_false"/>
  <xs:attribute name="dropzone" type="xs:NMTOKENS"/>
  <xs:attribute name="hidden">
    <xs:simpleType>
      <xs:restriction base="xs:token">
        <xs:pattern value="([Hh][Ii][Dd][Dd][Ee][Nn])?"/>
      </xs:restriction>
    </xs:simpleType>
  </xs:attribute>
  <xs:attribute name="id" type="xs:ID"/>
  <xs:attribute name="lang" type="xs:language"/>
  <xs:attribute name="spellcheck" type="true_false"/>
  <xs:attribute name="style" type="xs:string"/>
  <xs:attribute name="tabindex" type="xs:integer"/>
  <xs:attribute name="title" type="xs:string"/>
  <!-- To accommodate data- attrs -->
  <xs:anyAttribute processContents="lax"/>
</xs:attributeGroup>
  
<!-- All globals, including dir -->
<xs:attributeGroup name="globals">
  <xs:attributeGroup ref="globals_minus_dir"/>
  <xs:attribute name="dir">
    <xs:simpleType>
      <xs:restriction base="xs:token">
        <xs:enumeration value="ltr"/>
        <xs:enumeration value="rtl"/>              
      </xs:restriction>
    </xs:simpleType>
  </xs:attribute>
</xs:attributeGroup>
  
<!-- Attributes used by <ol> elements -->
<xs:attributeGroup name="ol_attrs">
  <xs:attribute name="reversed">
    <xs:simpleType>
      <xs:restriction base="xs:string">
        <!-- Must be a case-insensitive match for "reversed" or empty string -->
        <xs:pattern value="([Rr][Ee][Vv][Ee][Rr][Ss][Ee][Dd])?"/>            
      </xs:restriction>
    </xs:simpleType>
  </xs:attribute>
  <xs:attribute name="start" type="xs:integer"/>
  <xs:attribute name="type">
    <xs:simpleType>
      <xs:restriction base="xs:token">
        <xs:enumeration value="1"/>
        <xs:enumeration value="a"/>
        <xs:enumeration value="A"/>
        <xs:enumeration value="i"/>
        <xs:enumeration value="I"/>
      </xs:restriction>
    </xs:simpleType>
  </xs:attribute>
</xs:attributeGroup>
  
<!-- Media attributes used by both <audio> and <video> elements -->
<xs:attributeGroup name="generalmediaattributes">
  <xs:attribute name="src" type="xs:anyURI"/>
  <xs:attribute name="preload">
    <xs:simpleType>
      <xs:restriction base="xs:token">
        <xs:enumeration value="auto"/>
        <xs:enumeration value="metadata"/>
        <xs:enumeration value="none"/>
      </xs:restriction>
    </xs:simpleType>
  </xs:attribute>
  <xs:attribute name="autoplay">
    <xs:simpleType>
      <xs:restriction base="xs:token">
        <xs:pattern value="([Aa][Uu][Tt][Oo][Pp][Ll][Aa][Yy])?"/>
      </xs:restriction>
    </xs:simpleType>
  </xs:attribute>
  <xs:attribute name="mediagroup" type="xs:string"/>
  <xs:attribute name="loop">
    <xs:simpleType>
      <xs:restriction base="xs:token">
        <xs:pattern value="([Ll][Oo][Oo][Pp])?"/>
      </xs:restriction>
    </xs:simpleType>
  </xs:attribute>
  <xs:attribute name="muted">
    <xs:simpleType>
      <xs:restriction base="xs:token">
        <xs:pattern value="([Mm][Uu][Tt][Ee][Dd])?"/>
      </xs:restriction>
    </xs:simpleType>
  </xs:attribute>
  <xs:attribute name="controls">
    <xs:simpleType>
      <xs:restriction base="xs:token">
        <xs:pattern value="([Cc][Oo][Nn][Tt][Rr][Oo][Ll][Ss])?"/>
      </xs:restriction>
    </xs:simpleType>
  </xs:attribute>
</xs:attributeGroup>
  
<xs:attributeGroup name="videomediaattributes">
  <xs:attributeGroup ref="generalmediaattributes"/>
  <xs:attribute name="poster" type="xs:anyURI"/>
  <xs:attribute name="width" type="xs:string"/>
  <xs:attribute name="height" type="xs:string"/>
</xs:attributeGroup>
  
<!-- Table cell attributes shared by both th and td (does not include th-specific element scope) -->
<xs:attributeGroup name="tablecellattributes">
  <xs:attribute name="colspan" type="positive_int"/>
  <xs:attribute name="rowspan" type="positive_int"/>
  <!-- Per HTML5 spec, each space-separated token in "headers" should be an idref pointing to
       the id on a corresponding <th> in the same table, but not enforcing this in the Schema -->
  <xs:attribute name="headers" type="xs:NMTOKENS"/>
</xs:attributeGroup>
  
</xs:schema>
<?xml version="1.0"?>
<html xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://www.w3.org/1999/xhtml" lang="en" xsi:schemaLocation="http://www.w3.org/1999/xhtml ./schema/htmlbook.xsd">
<head>
  <meta charset="UTF-8"/>
  <title>Timbuctoo REST API V2.1 documentation</title>
  <script src="https://www.w3.org/Tools/respec/respec-w3c-common" async="async" class="remove">

  </script>
  <script class="remove">
        var respecConfig = {
          specStatus: "unofficial",
          editors: [
            {
              name:       "Jauco Noordzij",
              company:    "Huygens ING"
            },
            {
              name:       "Martijn Maas",
              company:    "Huygens ING"
            },
            {
              name:       "Ren&#xE9; van der Ark",
              company:    "Huygens ING"
            }
          ],
          issueBase: "http://jira.huygens.knaw.nl/TIM-",
          shortName: "timbuctoov2.1"
        };
  </script>
</head>
<body data-type="book">
  <h1>Timbuctoo REST API documentation</h1>
  <section id="abstract" data-type="chapter">
    <p>
      This specification describes the workings of the v2.1 version of the Timbuctoo REST API.
    </p>
  </section>
  <section data-type="chapter" id="auth">
    <h2>Authentication</h2>
    <html xmlns:c="http://www.concordion.org/2007/concordion" xmlns:h="http://huygens.knaw.nl/concordion-http-verifier" lang="en">
<head><meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
  <meta charset="UTF-8"/>
  <title>Timbuctoo v2.1 Authentication API</title>
<link type="text/css" rel="stylesheet" href="../../../../../../concordion.css"/></head>
<body>
  <section data-type="chapter">
    <h2>Preface</h2>
    <p>
      This specification describes the workings of the v2.1 version of the Timbuctoo REST API for authentication.
    </p>
  </section>

  <section data-type="chapter">
    <h2>Local login</h2>
    <aside class="example">
      <div class="requestCaption">Request:</div><div class="requestContent"><pre><span>POST </span><b>/v2.1/authenticate </b><span class="defaultValue">HTTP/1.1</span>
Authorization: Basic dXNlcjpwYXNzd29yZA==</pre></div>
      <div class="responseCaption">Response:</div><div class="requestContent"><pre><span class="defaultValue">HTTP/1.1</span> <span class="respStatus success">204</span>
<span class="respHeader success">X_AUTH_TOKEN: <span class="respHeaderValue"/>Timbuctoodcdce6a0-f569-4f28-963c-49ca072eae27</span>

<span class="respBody success">&#xA0;</span></pre></div>
    </aside>
    You then get a X_AUTH_TOKEN header back (In this case <span c:echo="#authPost.headers.x_auth_token">Timbuctoodcdce6a0-f569-4f28-963c-49ca072eae27</span>)
    that you can use to get your own user information.
  </section>
  <section data-type="chapter">
    <h2>Get user information</h2>
    <aside class="example">
      <div class="requestCaption">Request:</div><div class="requestContent"><pre><span>GET </span><b>/v2.1/system/users/me </b><span class="defaultValue">HTTP/1.1</span>
Authorization: Timbuctoodcdce6a0-f569-4f28-963c-49ca072eae27
VRE_ID: WomenWriters</pre></div>
      <div class="responseCaption">Response:</div><div class="requestContent"><pre><span class="defaultValue">HTTP/1.1</span> <span class="respStatus success">200</span>

<span class="respBody success">{
  "displayName":"/.*/"
}</span></pre></div>
    </aside>
  </section>

<div class="footer">Results generated by <a href="http://www.concordion.org" style="font-weight: bold; text-decoration: none; color: #89C;">Concordion</a><div class="testTime">in 482 ms on 18-Dec-2015 at 10:07:32 CET</div></div></body>
</html>
  </section>
  <hr/>
  <section data-type="chapter" id="facetedSearch">
    <h2>Faceted Search</h2>
    <html xmlns:c="http://www.concordion.org/2007/concordion" xmlns:h="http://huygens.knaw.nl/concordion-http-verifier" lang="en">
<head><meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
  <meta charset="UTF-8"/>
  <title>Timbuctoo v2.1 Faceted search API</title>
<link type="text/css" rel="stylesheet" href="../../../../../../concordion.css"/></head>
<body>
  <section data-type="chapter">
    <h2>Preface</h2>
    Timbuctoo has support for building faceted searches. Doing a faceted search usually follows the following steps.
    <ol>
      <li>You <a href="#retrievingFacets">retrieve facets</a> by performing an empty POST to the search endpoint, and GET the returned location</li>
      <li>You present the returned facets to the user</li>
      <li>The user selects some combination of facets</li>
      <li>You <a href="#searchingUsingFacets">search</a> using the selected facets</li>
      <li>You present the returned results to the user and update your facet list based on the new facets</li>
      <li>The user updates its combination of facets</li>
      <li>etc.</li>
    </ol>
  </section>
  <section data-type="chapter">
    <h2>Retrieving facets</h2>
    Let's assume we're searching the collection <b>ckccpersons</b>.
    <aside class="example highlight">
        <div class="requestCaption">Request:</div><div class="requestContent"><pre><span>POST </span><b>/v2.1/search/ckccpersons </b><span class="defaultValue">HTTP/1.1</span>
VRE_ID: CKCC
Content-type: application/json

<span class="reqBody">{}</span></pre></div>
        <div class="responseCaption">Response:</div><div class="requestContent"><pre><span class="defaultValue">HTTP/1.1</span> <span class="respStatus success">201</span>
<span class="respHeader success">Location: <span class="respHeaderValue"/>https://test.repository.huygens.knaw.nl/v2.1/search/f4544787-8975-499a-9494-8fb834dcdc10</span>

<span class="respBody success">&#xA0;</span></pre></div>
    </aside>
    <p>
      You then get a Location header back (In this case <small><span c:echo="#searchPost.headers.location">https://test.repository.huygens.knaw.nl/v2.1/search/f4544787-8975-499a-9494-8fb834dcdc10</span></small>)
      that contains <span c:assertEquals="isFullyQualified(#searchPost.headers.location)" class="success">a fully qualified HTTP url</span>.
      This url is valid during the next few hours. Once it starts returning 404's you are expected to retry the POST.
    </p>
    <aside id="emptyRetrieveResponse" class="example highlight">
      <div class="requestCaption">Request:<small> (to https://test.repository.huygens.knaw.nl)</small></div><div class="requestContent"><pre><span>GET </span><b>/v2.1/search/f4544787-8975-499a-9494-8fb834dcdc10 </b><span class="defaultValue">HTTP/1.1</span></pre></div>
      <div class="responseCaption">Response:</div><div class="requestContent"><pre><span class="defaultValue">HTTP/1.1</span> <span class="respStatus success">200</span>

<span class="respBody failure"><del class="expected">{
  _next: "https?://.*",
  facets: [
    {
      name: "dynamic_s_.+",
      type: "LIST",
      options: [{
        name: ".+",
        count: "?Number"
      }]
    },
    {
      name: "dynamic_i_.+",
      type: "RANGE",
      options: [{
        upperLimit: "?Number",
        lowerLimit: "?Number"
      }]
    }
  ],
  fullTextSearchFields: ["dynamic_t_.+"],
  refs: [{
    data: {},
    displayName: ".+",
    path: "[^/].*"
  }],
  sortableFields: ["dynamic_(k|sort)_.+"],
  start: "?Number",
  rows: "?Number",
  numFound: "?Number"
}</del>
<ins class="actual">_next
Expected: https?://.*
     got: https://test.repository.huygens.knaw.nl/v2.1/search/f4544787-8975-499a-9494-8fb834dcdc10?start=10&amp;rows=10
 ; facets[]: Expected 2 values but got 6 ; fullTextSearchFields[]
Expected: dynamic_t_.+
     but none found
 ; fullTextSearchFields[]
Unexpected: dynamic_t_name
 ; numFound
Expected: ?Number
     got: 3635
 ; refs[]: Expected 1 values but got 10 ; rows
Expected: ?Number
     got: 10
 ; sortableFields[]: Expected 1 values but got 3 ; start
Expected: ?Number
     got: 0
</ins></span></pre></div>
    </aside>
    <ul>
      <li>
        numFound contains the total number of records that match the query and is therefore always greater than, or
        equal to the facet numbers and the rows property.
      </li>
      <li>
        start contains the offset, in items
      </li>
      <li>
        rows contains the amount of rows in the returned dataset. This is always equal to the length of the terms array
      </li>
      <li>
        Rows might be less then 10 when the resultset contains no more items.
      </li>
    </ul>
  </section>
  <section data-type="chapter">
    <h2>Searching with the selected facets</h2>
    <p>
      You can use the information in the facets, sortableFields and fullTextSearchFields to create a query form. You can
      use the information from the refs property to show a set of results.
    </p>
    <p>
      The form should then create a POST containing those facets and fulltext fields that you wish to filter on. Let's
      use a different domain (charterportaal) for our next search.
    </p>
    <aside class="example highlight">
      <div class="requestCaption">Request:</div><div class="requestContent"><pre><span>POST </span><b>/v2.1/search/charterdocuments </b><span class="defaultValue">HTTP/1.1</span>
VRE_ID: Charter
Content-type: application/json

<span class="reqBody">{
  "facetValues":[
    {
      "name": "dynamic_s_fonds",
      "values": [
        "Graven van Holland (3.01.01)"
      ]
    }
  ],
  "fullTextSearchParameters": [
    {
      "name": "dynamic_t_alltext",
      "term": "akte"
    }
  ]
}</span></pre></div>
      <div class="responseCaption">Response:</div><div class="requestContent"><pre><span class="defaultValue">HTTP/1.1</span> <span class="respStatus success">201</span>
<span class="respHeader success">Location: <span class="respHeaderValue"/>https://test.repository.huygens.knaw.nl/v2.1/search/e075323a-cb83-4e97-88f9-57a204a6e774</span>

<span class="respBody success">&#xA0;</span></pre></div>
    </aside>
    So you present a LIST facet with an array of strings
    <aside class="example highlight">
      <div class="requestCaption">Request:<small> (to https://test.repository.huygens.knaw.nl)</small></div><div class="requestContent"><pre><span>GET </span><b>/v2.1/search/e075323a-cb83-4e97-88f9-57a204a6e774 </b><span class="defaultValue">HTTP/1.1</span></pre></div>
      (the response spec below is identical to spec in the example of <a href="#emptyRetrieveResponse">retrieving facets</a>)
      <div class="responseCaption">Response:</div><div class="requestContent"><pre><span class="defaultValue">HTTP/1.1</span> <span class="respStatus success">200</span>

<span class="respBody failure"><del class="expected">{
  _next: "https?://.*",
  facets: [
    {
      name: "dynamic_s_.+",
      type: "LIST",
      options: [{
        name: ".+",
        count: "?Number"
      }]
    },
    {
      name: "dynamic_i_.+",
      type: "RANGE",
      options: [{
        upperLimit: "?Number",
        lowerLimit: "?Number"
      }]
    }
  ],
  fullTextSearchFields: ["dynamic_t_.+"],
  refs: [{
    data: {},
    displayName: ".+",
    path: "[^/].*"
  }],
  sortableFields: ["dynamic_(k|sort)_.+"],
  start: "?Number",
  rows: "?Number",
  numFound: "?Number"
}</del>
<ins class="actual">_next
Expected: https?://.*
     got: https://test.repository.huygens.knaw.nl/v2.1/search/e075323a-cb83-4e97-88f9-57a204a6e774?start=10&amp;rows=10
 ; facets[]: Expected 2 values but got 5 ; fullTextSearchFields[]: Expected 1 values but got 3 ; numFound
Expected: ?Number
     got: 667
 ; refs[]: Expected 1 values but got 10 ; rows
Expected: ?Number
     got: 10
 ; sortableFields[]: Expected 1 values but got 3 ; start
Expected: ?Number
     got: 0
</ins></span></pre></div>
    </aside>
  </section>
<div class="footer">Results generated by <a href="http://www.concordion.org" style="font-weight: bold; text-decoration: none; color: #89C;">Concordion</a><div class="testTime">in 1184 ms on 18-Dec-2015 at 10:07:34 CET</div></div></body>
</html>
  </section>
  <hr/>
  <section data-type="chapter" id="wwcollective">
    <h2>WWCollective</h2>
    <html xmlns:c="http://www.concordion.org/2007/concordion" xmlns:h="http://huygens.knaw.nl/concordion-http-verifier" lang="en">
<head><meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
    <meta charset="UTF-8"/>
    <title>Timbuctoo v2.1 WWCollective API</title>
<link type="text/css" rel="stylesheet" href="../../../../../../concordion.css"/></head>
<body>
  <section data-type="chapter">
    <h2>Preface</h2>
    <p>
        This specification describes the workings of the v2.1 version of the Timbuctoo REST API for wwdocuments
    </p>
    <span c:execute="#token=getAuthenticationToken()">For each test we expect the user is logged in and uses token
      <b><span c:echo="#token">Timbuctoofb11e10d-201e-4e9a-b096-866a38faa745</span></b>.</span>
  </section>

  <section data-type="chapter">
    <h2>Create a new wwcollective with POST</h2>

    <aside class="example">
      <p>When a valid POST is performed to wwcollectives</p>
      <div class="requestCaption">Request:</div><div class="requestContent"><pre><span>POST </span><b>/v2.1/domain/wwcollectives </b><span class="defaultValue">HTTP/1.1</span>
Authorization: Timbuctoofb11e10d-201e-4e9a-b096-866a38faa745
Content-type: application/json
VRE_ID: WomenWriters

<span class="reqBody">{
  "@type": "wwcollective",
  "type": "ACADEMY",
  "name": "Testcollective",
  "links": [{
      "url": "http://example.com",
      "label": "Test link"
  }]
}</span></pre></div>
        <p>The server will respond with a location header containing the URL of the created resource</p>
        <div class="responseCaption">Response:</div><div class="requestContent"><pre><span class="defaultValue">HTTP/1.1</span> <span class="respStatus success">201</span>
<span class="respHeader success">Location: <span class="respHeaderValue"/>http://test.repository.huygens.knaw.nl/v2.1/domain/wwcollectives/80125a84-162d-47e3-b935-d17d91c49bc7</span>

<span class="respBody success">&#xA0;</span></pre></div>
    </aside>
    <span c:execute="#recordId=getRecordId()"/>
    <p>
      The field <b>type</b> should have one of these values:
      <ul>
        <li>UNKNOWN</li>
        <li>ACADEMY</li>
        <li>ASSOCIATION</li>
        <li>LIBRARY</li>
        <li>PUBLISHER</li>
        <li>SHOP</li>
      </ul>
    </p>
    <p>
      After at most <b>60</b> seconds the new record
      <span c:execute="#pid=retrievePid()">
        <span c:assertTrue="recordHasPid()" class="success">
          should have persistent ID in the field <i>^pid</i>:
          <b><span c:echo="#pid">http://hdl.handle.net/11240.1/8b933987-2d3c-4962-9ed4-5b5b601f174d</span></b>
        </span>.
      </span>
    </p>
  </section>

  <section data-type="chapter">
    <h2>Performing GET to the recently created wwcollective resource</h2>
    <aside class="example">
      <p>When a GET is performed to the wwcollective </p>
      <div class="requestCaption">Request:<small> (to http://test.repository.huygens.knaw.nl)</small></div><div class="requestContent"><pre><span>GET </span><b>/v2.1/domain/wwcollectives/80125a84-162d-47e3-b935-d17d91c49bc7 </b><span class="defaultValue">HTTP/1.1</span>
Accept: application/json</pre></div>
      <p>The server will respond with the created resource</p>
      <div class="responseCaption">Response:</div><div class="requestContent"><pre><span class="defaultValue">HTTP/1.1</span> <span class="respStatus success">200</span>
<span class="respHeader success">Content-type: <span class="respHeaderValue">application/json</span></span>

<span class="respBody success">{
    "_id": "80125a84-162d-47e3-b935-d17d91c49bc7",
    "@type": "wwcollective",
    "@relations": {},
    "@relationCount": 0,
    "@variationRefs": [
        {
            "id": "80125a84-162d-47e3-b935-d17d91c49bc7",
            "type": "wwcollective"
        },
        {
            "id": "80125a84-162d-47e3-b935-d17d91c49bc7",
            "type": "collective"
        }
    ],
    "^created": {
        "username": "/.*/",
        "userId": "/.*/",
        "vreId": "WomenWriters",
        "timeStamp": "/^\\d+$/"
    },
    "^modified": {
        "username": "/.*/",
        "userId": "/.*/",
        "vreId": "WomenWriters",
        "timeStamp": "/^\\d+$/"
    },
    "^rev": 1,
    "^pid": "/.*/",
    "^deleted": false,
    "type": "ACADEMY",
    "name": "Testcollective",
    "links": [{
        "url": "http://example.com",
        "label": "Test link"
    }]
}</span></pre></div>
    </aside>

  </section>

  <section data-type="chapter">
    <h2>Update the wwcollective with PUT</h2>

    <aside class="example">
      <p>When a valid PUT is performed the wwcollective</p>
      <div class="requestCaption">Request:<small> (to http://test.repository.huygens.knaw.nl)</small></div><div class="requestContent"><pre><span>PUT </span><b>/v2.1/domain/wwcollectives/80125a84-162d-47e3-b935-d17d91c49bc7 </b><span class="defaultValue">HTTP/1.1</span>
Authorization: Timbuctoofb11e10d-201e-4e9a-b096-866a38faa745
Content-type: application/json
VRE_ID: WomenWriters

<span class="reqBody">{
  "_id": "80125a84-162d-47e3-b935-d17d91c49bc7",
  "@type": "wwcollective",
  "type": "LIBRARY",
  "name": "Testcollective updated",
  "links": [{
  "url": "http://example.com",
  "label": "Test link"
  }],
  "^rev": 1
}</span></pre></div>
      <p>The server will respond with a 200 OK status code.</p>
      <div class="responseCaption">Response:</div><div class="requestContent"><pre><span class="defaultValue">HTTP/1.1</span> <span class="respStatus success">200</span>

<span class="respBody success">&#xA0;</span></pre></div>
    </aside>
      <p>
        After at most <b>60</b> seconds the updated record
          <span c:execute="#pid=retrievePid()">
            <span c:assertTrue="recordHasPid()" class="success">
              should receive a new persistent ID:
              <b><span c:echo="#pid">http://hdl.handle.net/11240.1/8b933987-2d3c-4962-9ed4-5b5b601f174d</span></b>
            </span>.
          </span>
      </p>
  </section>

  <section data-type="chapter">
    <h2>Performing GET to the recently updated wwcollective resource</h2>
    <aside class="example">
      <p>When a GET is performed to the wwcollective </p>

      <div class="requestCaption">Request:<small> (to http://test.repository.huygens.knaw.nl)</small></div><div class="requestContent"><pre><span>GET </span><b>/v2.1/domain/wwcollectives/80125a84-162d-47e3-b935-d17d91c49bc7 </b><span class="defaultValue">HTTP/1.1</span>
Accept: application/json</pre></div>
      <p>The server will respond with the updated resource</p>

      <div class="responseCaption">Response:</div><div class="requestContent"><pre><span class="defaultValue">HTTP/1.1</span> <span class="respStatus success">200</span>
<span class="respHeader success">Content-type: <span class="respHeaderValue">application/json</span></span>

<span class="respBody success">{
  "_id": "80125a84-162d-47e3-b935-d17d91c49bc7",
  "@type": "wwcollective",
  "^rev": 2,
  "name": "Testcollective updated",
  "type": "LIBRARY"
}</span></pre></div>
    </aside>
  </section>

  <section data-type="chapter">
    <h2>Deleting a wwcollective</h2>
    <aside class="example">
      <p>When a DELETE is sent to an existing wwcollective resource</p>

      <div class="requestCaption">Request:<small> (to http://test.repository.huygens.knaw.nl)</small></div><div class="requestContent"><pre><span>DELETE </span><b>/v2.1/domain/wwcollectives/80125a84-162d-47e3-b935-d17d91c49bc7 </b><span class="defaultValue">HTTP/1.1</span>
Authorization: Timbuctoofb11e10d-201e-4e9a-b096-866a38faa745
VRE_ID: WomenWriters</pre></div>
      <p>The server will respond with statusCode 204 no content</p>

      <div class="responseCaption">Response:</div><div class="requestContent"><pre><span class="defaultValue">HTTP/1.1</span> <span class="respStatus success">204</span>

<span class="respBody success">&#xA0;</span></pre></div>
    </aside>
  </section>


  <section data-type="chapter">
    <h2>Trying to retrieve the deleted record</h2>
    <aside class="example">
      <p>When a GET is sent to the recently deleted wwcollective resource</p>

      <div class="requestCaption">Request:<small> (to http://test.repository.huygens.knaw.nl)</small></div><div class="requestContent"><pre><span>GET </span><b>/v2.1/domain/wwcollectives/80125a84-162d-47e3-b935-d17d91c49bc7 </b><span class="defaultValue">HTTP/1.1</span>
Accept: application/json</pre></div>
      <p>The server will respond with statusCode 404 not found</p>

      <div class="responseCaption">Response:</div><div class="requestContent"><pre><span class="defaultValue">HTTP/1.1</span> <span class="respStatus success">404</span>

<span class="respBody success">&#xA0;</span></pre></div>
    </aside>
  </section>
<div class="footer">Results generated by <a href="http://www.concordion.org" style="font-weight: bold; text-decoration: none; color: #89C;">Concordion</a><div class="testTime">in 5785 ms on 18-Dec-2015 at 10:07:40 CET</div></div></body>
</html>
  </section>
  <hr/>
  <section data-type="chapter" id="wwdocument">
    <h2>WWDocument</h2>
    <html xmlns:c="http://www.concordion.org/2007/concordion" xmlns:h="http://huygens.knaw.nl/concordion-http-verifier" lang="en">
<head><meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
    <meta charset="UTF-8"/>
    <title>Timbuctoo v2.1 WWDocument API</title>
<link type="text/css" rel="stylesheet" href="../../../../../../concordion.css"/></head>
<body>
  <section data-type="chapter">
    <h2>Preface</h2>
    <p>
        This specification describes the workings of the v2.1 version of the Timbuctoo REST API for wwdocuments
    </p>
    <span c:execute="#token=getAuthenticationToken()">For each test we expect the user is logged in and uses token
    <b><span c:echo="#token">Timbuctooe03570ca-ea51-4f68-bb7e-f4fab1139ab0</span></b>.</span>
  </section>



  <section data-type="chapter">
    <h2>Create a new wwdocument with POST</h2>

    <aside class="example">
      <p>When a valid POST is performed to wwdocuments</p>

      <div class="requestCaption">Request:</div><div class="requestContent"><pre><span>POST </span><b>/v2.1/domain/wwdocuments </b><span class="defaultValue">HTTP/1.1</span>
Authorization: Timbuctooe03570ca-ea51-4f68-bb7e-f4fab1139ab0
Content-type: application/json
VRE_ID: WomenWriters

<span class="reqBody">{
  "@type": "wwdocument",
  "documentType": "PERIODICAL",
  "englishTitle": "English title",
  "title": "Title",
  "date": "1850",
  "reference": "A reference",
  "notes": "A note",
  "links": [{
    "url": "http://example.com",
    "label": "Test link"
  }]
}</span></pre></div>
      <p>The server will respond with a location header containing the URL of the created resource</p>

      <div class="responseCaption">Response:</div><div class="requestContent"><pre><span class="defaultValue">HTTP/1.1</span> <span class="respStatus success">201</span>
<span class="respHeader success">Location: <span class="respHeaderValue"/>http://test.repository.huygens.knaw.nl/v2.1/domain/wwdocuments/774072c0-751b-41f9-85f3-37160742ba83</span>

<span class="respBody success">&#xA0;</span></pre></div>
    </aside>
    <span c:execute="#recordId=getRecordId()"/>
    <p>
      The field <b>documentType</b> should have one of these values:
      <ul>
        <li>UNKNOWN</li>
        <li>ANTHOLOGY</li>
        <li>ARTICLE</li>
        <li>AWARD</li>
        <li>CATALOGUE</li>
        <li>COMPILATION</li>
        <li>DIARY</li>
        <li>LETTER</li>
        <li>LIST</li>
        <li>MONOGRAPH</li>
        <li>PERIODICAL</li>
        <li>PICTURE</li>
        <li>PUBLICITY</li>
        <li>SHEETMUSIC</li>
        <li>THEATERSCRIPT</li>
        <li>WORK</li>
      </ul>
    </p>

    <p>
      The field <b>resourceType</b> is currently not used by the frontend but should be one of these values:
      <ul>
        <li>UNKNOWN</li>
        <li>IMAGE</li>
        <li>SOUND</li>
        <li>TEXT</li>
      </ul>
      It will now default to <b>UNKNOWN</b>
    </p>
    <p>
      After at most <b>60</b> seconds the new record
        <span c:execute="#pid=retrievePid()">
          <span c:assertTrue="recordHasPid()" class="success">
            should have persistent ID in the field <i>^pid</i>:
            <b><span c:echo="#pid">http://hdl.handle.net/11240.1/1f4d282d-dfdc-454a-b1e2-753632f21f64</span></b>
          </span>.
        </span>
    </p>
  </section>


  <section data-type="chapter">
    <h2>Performing GET to the recently created wwdocument resource</h2>
    <aside class="example">
        <p>When a GET is performed to the wwdocument </p>

      <div class="requestCaption">Request:<small> (to http://test.repository.huygens.knaw.nl)</small></div><div class="requestContent"><pre><span>GET </span><b>/v2.1/domain/wwdocuments/774072c0-751b-41f9-85f3-37160742ba83 </b><span class="defaultValue">HTTP/1.1</span>
Accept: application/json</pre></div>
      <p>The server will respond with the created resource</p>

      <div class="responseCaption">Response:</div><div class="requestContent"><pre><span class="defaultValue">HTTP/1.1</span> <span class="respStatus success">200</span>
<span class="respHeader success">Content-type: <span class="respHeaderValue">application/json</span></span>

<span class="respBody success">{
  "_id": "774072c0-751b-41f9-85f3-37160742ba83",
  "@type": "wwdocument",
  "@relations": {},
  "@relationCount": 0,
  "@variationRefs": [
    {
      "id": "774072c0-751b-41f9-85f3-37160742ba83",
      "type": "wwdocument"
    },
    {
      "id": "774072c0-751b-41f9-85f3-37160742ba83",
      "type": "document"
    }
  ],
    "^created": {
    "username": "/.*/",
    "userId": "/.*/",
    "vreId": "WomenWriters",
    "timeStamp": "/^\\d+$/"
  },
  "^modified": {
    "username": "/.*/",
    "userId": "/.*/",
    "vreId": "WomenWriters",
    "timeStamp": "/^\\d+$/"
  },
  "^rev": 1,
  "^pid": "/.*/",
  "^deleted": false,
  "date": "1850",
  "title": "Title",
  "englishTitle": "English title",
  "documentType": "PERIODICAL",
  "reference": "A reference",
  "notes": "A note",
  "links": [{
    "url": "http://example.com",
    "label": "Test link"
  }]
}</span></pre></div>
    </aside>
  </section>

  <section data-type="chapter">
    <h2>Update the wwdocument with PUT</h2>

    <aside class="example">
      <p>When a valid PUT is performed the wwdocument</p>

      <div class="requestCaption">Request:<small> (to http://test.repository.huygens.knaw.nl)</small></div><div class="requestContent"><pre><span>PUT </span><b>/v2.1/domain/wwdocuments/774072c0-751b-41f9-85f3-37160742ba83 </b><span class="defaultValue">HTTP/1.1</span>
Authorization: Timbuctooe03570ca-ea51-4f68-bb7e-f4fab1139ab0
Content-type: application/json
VRE_ID: WomenWriters

<span class="reqBody">{
  "_id": "774072c0-751b-41f9-85f3-37160742ba83",
  "@type": "wwdocument",
  "documentType": "PERIODICAL",
  "englishTitle": "English title updated",
  "title": "Title updated",
  "date": "1850",
  "reference": "A reference",
  "notes": "A note",
  "links": [{
    "url": "http://example.com",
    "label": "Test link"
  }],
  "^rev": 1
}</span></pre></div>
      <p>The server will respond with a 200 OK status code.</p>
      <div class="responseCaption">Response:</div><div class="requestContent"><pre><span class="defaultValue">HTTP/1.1</span> <span class="respStatus success">200</span>

<span class="respBody success">&#xA0;</span></pre></div>
    </aside>
    <p>
      After at most <b>60</b> seconds the updated record
      <span c:execute="#pid=retrievePid()">
        <span c:assertTrue="recordHasPid()" class="success">
          should receive a new persistent ID:
          <b><span c:echo="#pid">http://hdl.handle.net/11240.1/1f4d282d-dfdc-454a-b1e2-753632f21f64</span></b>
        </span>.
      </span>
    </p>
  </section>

  <section data-type="chapter">
    <h2>Performing GET to the recently updated wwdocument resource</h2>
    <aside class="example">
      <p>When a GET is performed to the wwdocument </p>

      <div class="requestCaption">Request:<small> (to http://test.repository.huygens.knaw.nl)</small></div><div class="requestContent"><pre><span>GET </span><b>/v2.1/domain/wwdocuments/774072c0-751b-41f9-85f3-37160742ba83 </b><span class="defaultValue">HTTP/1.1</span>
Accept: application/json</pre></div>
      <p>The server will respond with the updated resource</p>

      <div class="responseCaption">Response:</div><div class="requestContent"><pre><span class="defaultValue">HTTP/1.1</span> <span class="respStatus success">200</span>
<span class="respHeader success">Content-type: <span class="respHeaderValue">application/json</span></span>

<span class="respBody success">{
  "_id": "774072c0-751b-41f9-85f3-37160742ba83",
  "@type": "wwdocument",
  "^rev": 2,
  "title": "Title updated",
  "englishTitle": "English title updated",
  "date": "1850"
}</span></pre></div>
    </aside>
  </section>

  <section data-type="chapter">
    <h2>Deleting a wwdocument</h2>
    <aside class="example">
      <p>When a DELETE is sent to an existing wwdocument resource</p>
      <div class="requestCaption">Request:<small> (to http://test.repository.huygens.knaw.nl)</small></div><div class="requestContent"><pre><span>DELETE </span><b>/v2.1/domain/wwdocuments/774072c0-751b-41f9-85f3-37160742ba83 </b><span class="defaultValue">HTTP/1.1</span>
Authorization: Timbuctooe03570ca-ea51-4f68-bb7e-f4fab1139ab0
VRE_ID: WomenWriters</pre></div>
      <p>The server will respond with statusCode 204 no content</p>
      <div class="responseCaption">Response:</div><div class="requestContent"><pre><span class="defaultValue">HTTP/1.1</span> <span class="respStatus success">204</span>

<span class="respBody success">&#xA0;</span></pre></div>
    </aside>
  </section>

  <section data-type="chapter">
    <h2>Trying to retrieve the deleted record</h2>
    <aside class="example">
      <p>When a GET is sent to the recently deleted wwdocument resource</p>
      <div class="requestCaption">Request:<small> (to http://test.repository.huygens.knaw.nl)</small></div><div class="requestContent"><pre><span>GET </span><b>/v2.1/domain/wwdocuments/774072c0-751b-41f9-85f3-37160742ba83 </b><span class="defaultValue">HTTP/1.1</span>
Accept: application/json</pre></div>
      <p>The server will respond with statusCode 404 not found</p>
      <div class="responseCaption">Response:</div><div class="requestContent"><pre><span class="defaultValue">HTTP/1.1</span> <span class="respStatus success">404</span>

<span class="respBody success">&#xA0;</span></pre></div>
    </aside>
  </section>

  <section data-type="chapter">
    <h2>GET wwdocuments collection</h2>
    <h3>A simple request</h3>
    <aside class="example">
        <div class="requestCaption">Request:</div><div class="requestContent"><pre><span>GET </span><b>/v2.1/domain/wwdocuments </b><span class="defaultValue">HTTP/1.1</span>
Accept: application/json</pre></div>
        <div class="responseCaption">Response:</div><div class="requestContent"><pre><span class="defaultValue">HTTP/1.1</span> <span class="respStatus success">200</span>
<span class="respHeader success">Content-Type: <span class="respHeaderValue">application/json</span></span>

<span class="respBody success">&#xA0;</span></pre></div>
    </aside>
    <span>A GET of the wwdocuments collection will return a json body that has <span c:assertEquals="getNumberOfItems(#response)" class="success">200</span> entries by default.
    </span>

    <h3>Pagination</h3>
    <aside class="example">
      <div class="requestCaption">Request:</div><div class="requestContent"><pre><span>GET </span><b>/v2.1/domain/wwdocuments?rows=20 </b><span class="defaultValue">HTTP/1.1</span>
Accept: application/json</pre></div>
      <div class="responseCaption">Response:</div><div class="requestContent"><pre><span class="defaultValue">HTTP/1.1</span> <span class="respStatus success">200</span>
<span class="respHeader success">Content-Type: <span class="respHeaderValue">application/json</span></span>

<span class="respBody success">&#xA0;</span></pre></div>
    </aside>
    <span>The rows query parameter is set to <span c:set="#rows">20</span> the number of items returned is <span c:assertEquals="getNumberOfItems(#response)" class="success">20</span>
    </span>

    <aside class="example">
      <div class="requestCaption">Request:</div><div class="requestContent"><pre><span>GET </span><b>/v2.1/domain/wwdocuments?rows=20&amp;start=20 </b><span class="defaultValue">HTTP/1.1</span>
Accept: application/json</pre></div>
      <div class="responseCaption">Response:</div><div class="requestContent"><pre><span class="defaultValue">HTTP/1.1</span> <span class="respStatus success">200</span>
<span class="respHeader success">Content-Type: <span class="respHeaderValue">application/json</span></span>

<span class="respBody success">&#xA0;</span></pre></div>
    </aside>
    <span>When start is set to 20 it skips the first 20 persons, so
      <span c:assertTrue="doesNotContainResult(#pagResponse, #response)" class="success">it does not contain any result of the previous request.</span>
    </span>
  </section>

  <section data-type="chapter">
    <h2>Invalid POST requests</h2>
    <aside class="example">
      <p>When a POST is performed to wwdocuments without an authentication token</p>
      <div class="requestCaption">Request:</div><div class="requestContent"><pre><span>POST </span><b>/v2.1/domain/wwdocuments </b><span class="defaultValue">HTTP/1.1</span></pre></div>
      <p>A 401 unauthorized statusCode is returned by the server response headers</p>
      <div class="responseCaption">Response:</div><div class="requestContent"><pre><span class="defaultValue">HTTP/1.1</span> <span class="respStatus success">401</span>

<span class="respBody success">&#xA0;</span></pre></div>
    </aside>
    <aside class="example">
      <p>When a POST is performed to wwdocuments without a VRE_ID</p>
      <div class="requestCaption">Request:</div><div class="requestContent"><pre><span>POST </span><b>/v2.1/domain/wwdocuments </b><span class="defaultValue">HTTP/1.1</span>
Authorization: Timbuctooe03570ca-ea51-4f68-bb7e-f4fab1139ab0</pre></div>
      <p>The expected response will be</p>
      <div class="responseCaption">Response:</div><div class="requestContent"><pre><span class="defaultValue">HTTP/1.1</span> <span class="respStatus success">401</span>
<span class="respHeader success">Content-Type: <span class="respHeaderValue">application/json</span></span>

<span class="respBody success">{
"statusCode": 401,
"message": "Missing VRE id"
}</span></pre></div>
    </aside>
    <aside class="example">
      <p>When a POST is performed to wwdocuments without a content body</p>
      <div class="requestCaption">Request:</div><div class="requestContent"><pre><span>POST </span><b>/v2.1/domain/wwdocuments </b><span class="defaultValue">HTTP/1.1</span>
Authorization: Timbuctooe03570ca-ea51-4f68-bb7e-f4fab1139ab0
VRE_ID: WomenWriters</pre></div>
      <p>The server will respond with a 415 statusCode: Unsupported media type</p>
      <div class="responseCaption">Response:</div><div class="requestContent"><pre><span class="defaultValue">HTTP/1.1</span> <span class="respStatus success">415</span>

<span class="respBody success">&#xA0;</span></pre></div>
    </aside>
    <aside class="example">
      <p>When a POST is performed to wwdocuments with an empty JSON body</p>
      <div class="requestCaption">Request:</div><div class="requestContent"><pre><span>POST </span><b>/v2.1/domain/wwdocuments </b><span class="defaultValue">HTTP/1.1</span>
Authorization: Timbuctooe03570ca-ea51-4f68-bb7e-f4fab1139ab0
Content-type: application/json
VRE_ID: WomenWriters

<span class="reqBody">{}</span></pre></div>
      <p>The server will respond with a 400 statusCode</p>
      <div class="responseCaption">Response:</div><div class="requestContent"><pre><span class="defaultValue">HTTP/1.1</span> <span class="respStatus success">400</span>

<span class="respBody success">[...] missing property '@type' [...]</span></pre></div>
    </aside>
  </section>
<div class="footer">Results generated by <a href="http://www.concordion.org" style="font-weight: bold; text-decoration: none; color: #89C;">Concordion</a><div class="testTime">in 6206 ms on 18-Dec-2015 at 10:07:47 CET</div></div></body>
</html>
  </section>
  <hr/>
  <section data-type="chapter" id="wwperson">
    <h2>WWPerson</h2>
    <html xmlns:c="http://www.concordion.org/2007/concordion" xmlns:h="http://huygens.knaw.nl/concordion-http-verifier" lang="en">
<head><meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
  <meta charset="UTF-8"/>
  <title>Timbuctoo v2.1 WWPerson API</title>
<link type="text/css" rel="stylesheet" href="../../../../../../concordion.css"/></head>
<body>
  <section data-type="chapter">
    <h2>Preface</h2>
    <p>
      This specification describes the workings of the v2.1 version of the Timbuctoo REST API for wwpersons
    </p>
    <span c:execute="#token=getAuthenticationToken()">For each test we expect the user is logged in and uses token
      <b><span c:echo="#token">Timbuctoo485ac587-8871-425d-9e26-a4dfe5c7c0df</span></b>.</span>
  </section>

  <section data-type="chapter">
    <h2>POST wwperson</h2>
    <aside class="example">
      <div class="requestCaption">Request:</div><div class="requestContent"><pre><span>POST </span><b>/v2.1/domain/wwpersons </b><span class="defaultValue">HTTP/1.1</span>
Content-type: application/json
Authorization: Timbuctoo485ac587-8871-425d-9e26-a4dfe5c7c0df
VRE_ID: WomenWriters

<span class="reqBody">{
  "@type": "wwperson",
  "names": [
    {
      "components": [
        {
          "type": "FORENAME",
          "value": "foreName1"
        },
        {
          "type": "SURNAME",
          "value": "surName1"
        }
      ]
    },
    {
      "components": [
        {
          "type": "FORENAME",
          "value": "foreName2"
        },
        {
          "type": "SURNAME",
          "value": "surName2"
        },
        {
          "type": "NAME_LINK",
          "value": "nameLink"
        },
        {
          "type": "ROLE_NAME",
          "value": "roleName"
        },
        {
          "type": "ADD_NAME",
          "value": "addName"
        },
        {
        "type": "GEN_NAME",
        "value": "genName"
        }
      ]
    }
  ],
  "gender": "UNKNOWN",
  "birthDate": "1589",
  "deathDate": "1653",
  "types": [
    "ARCHETYPE",
    "AUTHOR",
    "PSEUDONYM",
    "READER"
  ],
  "links":[
    {
    "url": "http://www.example.com",
    "label": "Example link"
    }
  ],
  "bibliography": "Some multi-lined\n text",
  "children": "UNKNOWN",
  "health": "Some multi-lined\n text",
  "livedIn": "Some multi-lined\n text",
  "nationality": "A name of a nationality",
  "notes": "Some multi-lined\n text",
  "personalSituation":"Some multi-lined\n text"
}</span></pre></div>
      <div class="responseCaption">Response:</div><div class="requestContent"><pre><span class="defaultValue">HTTP/1.1</span> <span class="respStatus success">201</span>
<span class="respHeader success">Location: <span class="respHeaderValue"/>http://test.repository.huygens.knaw.nl/v2.1/domain/wwpersons/6354fcb4-ff92-4805-b013-50f8a691c773</span>

<span class="respBody success">&#xA0;</span></pre></div>
    </aside>
    <span c:execute="#recordId=getRecordId()">
      A valid UUID is generated for this record: <b><span c:echo="#recordId">6354fcb4-ff92-4805-b013-50f8a691c773</span></b>.
    </span>
    <div>
      <p><i>gender</i> can contain one of the following values:
        <ul>
          <li>UNKNOWN</li>
          <li>MALE</li>
          <li>FEMALE</li>
          <li>NOT_APPLICABLE</li>
        </ul>
      </p>
      <p><i>names</i> also supports the format <i>20151231</i>.</p>
      <p><i>children</i> can contain one of the following values:
        <ul>
          <li>UNKNOWN</li>
          <li>YES</li>
          <li>NO</li>
        </ul>
      </p>
    </div>
    <span c:execute="#pid=retrievePid()"/>
    <span c:assertTrue="isValidPid(#pid)" class="success">Has a valid pid within 1 minute:
      <b>
        <span c:echo="#pid">http://hdl.handle.net/11240.1/aa46a846-6e6e-42c6-bc09-a05eda7ef7cf</span>
      </b>
    </span>
  </section>
  <section>
    <h2>GET a single wwperson</h2>

    <h3>GET an existing wwperson</h3>
    <p> We try to get the wwperson we created with the POST.</p>
    <aside class="example">
      <div class="requestCaption">Request:<small> (to http://test.repository.huygens.knaw.nl)</small></div><div class="requestContent"><pre><span>GET </span><b>/v2.1/domain/wwpersons/6354fcb4-ff92-4805-b013-50f8a691c773 </b><span class="defaultValue">HTTP/1.1</span>
Accept: application/json</pre></div>
      <div class="responseCaption">Response:</div><div class="requestContent"><pre><span class="defaultValue">HTTP/1.1</span> <span class="respStatus success">200</span>

<span class="respBody success">{
  "_id": "6354fcb4-ff92-4805-b013-50f8a691c773",
  "^rev": 1,
  "^pid": "/.*/",
  "@type": "wwperson",
  "names": [
    {
      "components": [
        {
          "type": "FORENAME",
          "value": "foreName1"
        },
        {
          "type": "SURNAME",
          "value": "surName1"
        }
      ]
    },
    {
      "components": [
        {
          "type": "FORENAME",
          "value": "foreName2"
        },
        {
          "type": "SURNAME",
          "value": "surName2"
        },
        {
          "type": "NAME_LINK",
          "value": "nameLink"
        },
        {
          "type": "ROLE_NAME",
          "value": "roleName"
        },
        {
          "type": "ADD_NAME",
          "value": "addName"
        },
        {
          "type": "GEN_NAME",
          "value": "genName"
        }
      ]
    }
  ],
  "gender": "UNKNOWN",
  "birthDate": "1589",
  "deathDate": "1653",
  "types": [
    "ARCHETYPE",
    "AUTHOR",
    "PSEUDONYM",
    "READER"
  ],
  "links":[
    {
      "url": "http://www.example.com",
      "label": "Example link"
    }
  ],
  "bibliography": "Some multi-lined\n text",
  "children": "UNKNOWN",
  "health": "Some multi-lined\n text",
  "livedIn": "Some multi-lined\n text",
  "nationality": "A name of a nationality",
  "notes": "Some multi-lined\n text",
  "personalSituation":"Some multi-lined\n text"
}</span></pre></div>
    </aside>
    <span c:echo="#response.getBody()">{"@type":"wwperson","names":[{"components":[{"type":"FORENAME","value":"foreName1"},{"type":"SURNAME","value":"surName1"}]},{"components":[{"type":"FORENAME","value":"foreName2"},{"type":"SURNAME","value":"surName2"},{"type":"NAME_LINK","value":"nameLink"},{"type":"ROLE_NAME","value":"roleName"},{"type":"ADD_NAME","value":"addName"},{"type":"GEN_NAME","value":"genName"}]}],"gender":"UNKNOWN","birthDate":"1589","deathDate":"1653","types":["ARCHETYPE","AUTHOR","PSEUDONYM","READER"],"links":[{"url":"http://www.example.com","label":"Example link"}],"floruit":null,"bibliography":"Some multi-lined\n text","children":"UNKNOWN","fsPseudonyms":[],"health":"Some multi-lined\n text","livedIn":"Some multi-lined\n text","nationality":"A name of a nationality","notes":"Some multi-lined\n text","personalSituation":"Some multi-lined\n text","tempOldId":null,"tempBirthPlace":null,"tempChildren":null,"tempCollaborations":null,"tempDeathPlace":null,"tempDeath":null,"tempFinancialSituation":null,"tempMemberships":null,"tempMotherTongue":null,"tempName":null,"tempPlaceOfBirth":null,"tempPsChildren":null,"tempPseudonyms":null,"tempSpouse":null,"relatedLocations":[],"_id":"6354fcb4-ff92-4805-b013-50f8a691c773","^rev":1,"^created":{"userId":"USER000000000014","vreId":"WomenWriters","timeStamp":1450429646053,"username":"givenName surname"},"^modified":{"userId":"USER000000000014","vreId":"WomenWriters","timeStamp":1450429646053,"username":"givenName surname"},"^displayName":null,"^pid":"http://hdl.handle.net/11240.1/aa46a846-6e6e-42c6-bc09-a05eda7ef7cf","^deleted":false,"@relationCount":0,"@properties":{},"@relations":{},"@variationRefs":[{"type":"wwperson","id":"6354fcb4-ff92-4805-b013-50f8a691c773"},{"type":"person","id":"6354fcb4-ff92-4805-b013-50f8a691c773"}]}</span>

    <h3>Get a none existing wwperson</h3>
    <aside class="example">

      <p>When a wwperson with unknown id '00000000-0000-0000-0000-000000000000' is requested.</p>

      <div class="requestCaption">Request:</div><div class="requestContent"><pre><span>GET </span><b>/v2.1/domain/wwpersons/00000000-0000-0000-0000-000000000000 </b><span class="defaultValue">HTTP/1.1</span>
Accept: application/json</pre></div>
      <p>The response will look like this:</p>
      <div class="responseCaption">Response:</div><div class="requestContent"><pre><span class="defaultValue">HTTP/1.1</span> <span class="respStatus success">404</span>

<span class="respBody success">&#xA0;</span></pre></div>
    </aside>
  </section>

  <section data-type="chapter">
    <h2>Delete the created person</h2>
    <aside class="example">
      <div class="requestCaption">Request:<small> (to http://test.repository.huygens.knaw.nl)</small></div><div class="requestContent"><pre><span>DELETE </span><b>/v2.1/domain/wwpersons/6354fcb4-ff92-4805-b013-50f8a691c773 </b><span class="defaultValue">HTTP/1.1</span>
Authorization: Timbuctoo485ac587-8871-425d-9e26-a4dfe5c7c0df
VRE_ID: WomenWriters</pre></div>
      <p>The response will look like this:</p>
      <div class="responseCaption">Response:</div><div class="requestContent"><pre><span class="defaultValue">HTTP/1.1</span> <span class="respStatus success">204</span>

<span class="respBody success">&#xA0;</span></pre></div>
    </aside>
  </section>

  <section data-type="chapter">
    <h2>GET wwperson collection</h2>
    <h3>A simple request</h3>
    <aside class="example">
      <div class="requestCaption">Request:</div><div class="requestContent"><pre><span>GET </span><b>/v2.1/domain/wwpersons </b><span class="defaultValue">HTTP/1.1</span>
Accept: application/json</pre></div>
      <div class="responseCaption">Response:</div><div class="requestContent"><pre><span class="defaultValue">HTTP/1.1</span> <span class="respStatus success">200</span>
<span class="respHeader success">Content-Type: <span class="respHeaderValue">application/json</span></span>

<span class="respBody success">&#xA0;</span></pre></div>
    </aside>
    <span>A GET of the wwperson collection will return a json body that has <span c:assertEquals="getNumberOfItems(#response)" class="success"><b>200</b></span> entries by default.
    </span>

    <h3>Pagination</h3>
    <aside class="example">
      <div class="requestCaption">Request:</div><div class="requestContent"><pre><span>GET </span><b>/v2.1/domain/wwpersons?rows=20 </b><span class="defaultValue">HTTP/1.1</span>
Accept: application/json</pre></div>
      <div class="responseCaption">Response:</div><div class="requestContent"><pre><span class="defaultValue">HTTP/1.1</span> <span class="respStatus success">200</span>
<span class="respHeader success">Content-Type: <span class="respHeaderValue">application/json</span></span>

<span class="respBody success">&#xA0;</span></pre></div>
    </aside>
    <span>The rows query parameter is set to <b>20</b> the number of items returned is <span c:assertEquals="getNumberOfItems(#response)" class="success"><b>20</b></span>.
    </span>

    <aside class="example">
      <div class="requestCaption">Request:</div><div class="requestContent"><pre><span>GET </span><b>/v2.1/domain/wwpersons?rows=20&amp;start=20 </b><span class="defaultValue">HTTP/1.1</span>
Accept: application/json</pre></div>
      <div class="responseCaption">Response:</div><div class="requestContent"><pre><span class="defaultValue">HTTP/1.1</span> <span class="respStatus success">200</span>
<span class="respHeader success">Content-Type: <span class="respHeaderValue">application/json</span></span>

<span class="respBody success">&#xA0;</span></pre></div>
    </aside>
    <span>When start is set to 20 it skips the first 20 persons, so
      <span c:assertTrue="doesNotContainResult(#pagResponse, #response)" class="success"><i>it does not contain any result of the
        previous request</i>.</span>
    </span>
  </section>
<div class="footer">Results generated by <a href="http://www.concordion.org" style="font-weight: bold; text-decoration: none; color: #89C;">Concordion</a><div class="testTime">in 6499 ms on 18-Dec-2015 at 10:07:32 CET</div></div></body>
</html>
  </section>
  <hr/>
</body>
</html>

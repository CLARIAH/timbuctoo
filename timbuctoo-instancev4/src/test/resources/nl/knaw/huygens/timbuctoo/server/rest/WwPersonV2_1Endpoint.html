<!DOCTYPE html>
<html lang="en"
      xmlns:c="http://www.concordion.org/2007/concordion"
      xmlns:h="http://huygens.knaw.nl/concordion-http-verifier">
<head>
  <meta charset="UTF-8"/>
  <title>Timbuctoo v2.1 WWPerson API</title>
  <script src='https://www.w3.org/Tools/respec/respec-w3c-common' async='async' class='remove'>
    Some content to trick concordion into treating this element as non-empty
  </script>
  <script class='remove'>
        var respecConfig = {
          specStatus: "unofficial",
          editors: [
            {
              name:       "Jauco Noordzij",
              company:    "Huygens ING"
            },
            {
              name:       "Martijn Maas",
              company:    "Huygens ING"
            },
            {
              name:       "Ren√© van der Ark",
              company:    "Huygens ING"
            }
          ],
          issueBase: "http://jira.huygens.knaw.nl/TIM-",
          shortName: "timbuctoov2.1"
        };
  </script>
</head>
<body>
  <section id='abstract'>
    <p>
      This specification describes the workings of the v2.1 version of the Timbuctoo REST API for wwpersons
    </p>
    <span c:execute="#token=getAuthenticationToken()">For each test we expect the user is logged in and uses token
      <b><span c:echo="#token"></span></b>.</span>
  </section>
  <section id="GETCollection">
    <h2>GET wwperson collection</h2>
    <h3>A simple request</h3>
    <aside class="example" h:http="#response">
      <div h:request="">
        GET /v2.1/domain/wwpersons HTTP/1.1
        Accept: application/json
      </div>
      <div h:response="">
        HTTP/1.1 200
        Content-Type: application/json
      </div>
    </aside>
    <span>A GET of the wwperson collection will return a json body that has <span
        c:assertEquals="getNumberOfItems(#response)">200</span> entries by default.
    </span>

    <h3>Pagination</h3>
    <aside class="example" h:http="#response">
      <div h:request="">
        GET /v2.1/domain/wwpersons?rows=20 HTTP/1.1
        Accept: application/json
      </div>
      <div h:response="">
        HTTP/1.1 200
        Content-Type: application/json
      </div>
    </aside>
    <span>The rows query parameter is set to <span c:set="#rows">20</span> the number of items returned is <span
        c:assertEquals="getNumberOfItems(#response)">20</span>
    </span>

    <aside class="example" h:http="#pagResponse">
      <div h:request="">
        GET /v2.1/domain/wwpersons?rows=20&amp;start=20 HTTP/1.1
        Accept: application/json
      </div>
      <div h:response="">
        HTTP/1.1 200
        Content-Type: application/json

      </div>
    </aside>
    <span>When start is set to 20 it skips the first 20 persons, so
      <span c:assertTrue="doesNotContainResult(#pagResponse, #response)">it does not contain any result of the previous request.</span>
    </span>
  </section>

  <section id="GETSingle">
    <h2>Get a single wwperson</h2>
    <aside class="example" h:http="#response">

      <p>When an unknown wwperson with id '00000000-0000-0000-0000-000000000000' is requested.</p>

      <span h:request="">
        GET /v2.1/domain/wwpersons/00000000-0000-0000-0000-000000000000 HTTP/1.1
        Accept: application/json
      </span>
      <p>The response will look like this:</p>
      <span h:response="">
        HTTP/1.1 404
        Content-Type: text/html;charset=utf-8
      </span>
    </aside>

    <aside class="example" h:http="#response">

      <p>A ww person with id '6b206d36-ba15-4ffa-98b1-530c4a06d799' is known/</p>

      <span h:request="">
        GET /v2.1/domain/wwpersons/6b206d36-ba15-4ffa-98b1-530c4a06d799 HTTP/1.1
        Accept: application/json
      </span>
      <span h:response="">
        HTTP/1.1 200
        Content-Type: application/json

        {
          "_id": "6b206d36-ba15-4ffa-98b1-530c4a06d799",
          "names":[
            {
              "components":[
                {
                  "type": "FORENAME",
                  "value": ".*"
                },
                {
                  "type": "SURNAME",
                  "value": ".*"
                },
                {
                  "type": "NAME_LINK",
                  "value": ".*"
                },
                {
                  "type": "ROLE_NAME",
                  "value": ".*"
                },
                {
                  "type": "ADD_NAME",
                  "value": ".*"
                },
                {
                  "type": "GEN_NAME",
                  "value": ".*"
                }
              ]
            }
          ],
          "birthDate": "?Datable",
          "deathDate": "?Datable",
          "types": [".*"],
          "links": [
            {url: ".*", label: ".*"}
          ],
          "bibliography": "(.|\\n|\\r)*",
          "notes": "(.|\\n|\\r)*",
          "^rev": "?Number",
          "^created": {
            "timeStamp": "?Number",
            "userId": ".*",
            "username": ".*",
            "vreId": ".*"
          },
          "^modified": {
            "timeStamp": "?Number",
            "userId": ".*",
            "username": ".*",
            "vreId": ".*"
          },
          "^deleted": "?Boolean",
          "^displayName": ".*",
          "^pid": "http://hdl.handle.net/[0-9]+/[a-z0-9\-]+",
          "@relationCount": "?Number",
          "@relations": {},
          "@properties": {},
          "@variationRefs": [
            {"id": "6b206d36-ba15-4ffa-98b1-530c4a06d799", type: ".*person"}
          ],
        }
      </span>
    </aside>
    <!--<span>The number of @relations should equal the value of @relationCount-->
      <!--<span c:assertTrue="numberOfRelationsEqualsRelationObjects(#response)">the @relationCount matches the number of @relations</span>-->
    <!--</span>-->
  </section>

</body>
</html>

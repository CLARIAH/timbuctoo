<!DOCTYPE html>
<html lang="en"
      xmlns:c="http://www.concordion.org/2007/concordion"
      xmlns:h="http://huygens.knaw.nl/concordion-http-verifier">
<head>
    <meta charset="UTF-8"/>
    <title>Timbuctoo v2.1 WWDocument API</title>
    <script src='https://www.w3.org/Tools/respec/respec-w3c-common' async='async' class='remove'>
    Some content to trick concordion into treating this element as non-empty
  </script>
    <script class='remove'>
        var respecConfig = {
          specStatus: "unofficial",
          editors: [
            {
              name:       "Jauco Noordzij",
              company:    "Huygens ING"
            },
            {
              name:       "Martijn Maas",
              company:    "Huygens ING"
            },
            {
              name:       "Ren√© van der Ark",
              company:    "Huygens ING"
            }
          ],
          issueBase: "http://jira.huygens.knaw.nl/TIM-",
          shortName: "timbuctoov2.1"
        };
  </script>
</head>
<body>
<section id='abstract'>
    <p>
        This specification describes the workings of the v2.1 version of the Timbuctoo REST API for wwdocuments
    </p>
    <span c:execute="#token=getAuthenticationToken()">For each test we expect the user is logged in and uses token
      <b><span c:echo="#token"></span></b>.</span>
</section>
<section id="GETCollection">
    <h2>GET wwdocuments collection</h2>
    <h3>A simple request</h3>
    <aside class="example" h:http="#response">
      <div h:request="">
        GET /v2.1/domain/wwdocuments HTTP/1.1
        Accept: application/json
      </div>
      <div h:response="">
        HTTP/1.1 200
        Content-Type: application/json
      </div>
    </aside>
    <span>A GET of the wwdocuments collection will return a json body that has <span
            c:assertEquals="getNumberOfItems(#response)">200</span> entries by default.
    </span>

    <h3>Pagination</h3>
    <aside class="example" h:http="#response">
      <div h:request="">
        GET /v2.1/domain/wwdocuments?rows=20 HTTP/1.1
        Accept: application/json
      </div>
      <div h:response="">
        HTTP/1.1 200
        Content-Type: application/json
      </div>
    </aside>
    <span>The rows query parameter is set to <span c:set="#rows">20</span> the number of items returned is <span
            c:assertEquals="getNumberOfItems(#response)">20</span>
    </span>

    <aside class="example" h:http="#pagResponse">
      <div h:request="">
        GET /v2.1/domain/wwdocuments?rows=20&amp;start=20 HTTP/1.1
        Accept: application/json
      </div>
      <div h:response="">
        HTTP/1.1 200
        Content-Type: application/json
      </div>
    </aside>
    <span>When start is set to 20 it skips the first 20 persons, so
      <span c:assertTrue="doesNotContainResult(#pagResponse, #response)">it does not contain any result of the previous request.</span>
    </span>
</section>

<section id="POST">
    <h2>POST to wwdocuments</h2>
    <aside class="example" h:http="#response">
        <p>When a POST is performed to wwdocuments without an authentication token</p>
        <div h:request="">
            POST /v2.1/domain/wwdocuments HTTP/1.1
        </div>
        <p>A 401 unauthorized statusCode is returned by the server response headers</p>
        <div h:response="">
            HTTP/1.1 401
        </div>
    </aside>
    <aside class="example" h:http="#response">
        <p>When a POST is performed to wwdocuments without a VRE_ID</p>
        <div h:request="">
            POST /v2.1/domain/wwdocuments HTTP/1.1
            Authorization: #token
        </div>
        <p>The expected response will be</p>
        <div h:response="">
            HTTP/1.1 401
            Content-Type: application/json

            {
                "statusCode": 401,
                "message": "Missing VRE id"
            }
        </div>
    </aside>
    <aside class="example" h:http="#response">
        <p>When a POST is performed to wwdocuments without a content body</p>
        <div h:request="">
            POST /v2.1/domain/wwdocuments HTTP/1.1
            Authorization: #token
            VRE_ID: WomenWriters
        </div>
        <p>The server will respond with a 415 statusCode: Unsupported media type</p>
        <div h:response="">
            HTTP/1.1 415
        </div>
    </aside>
    <aside class="example" h:http="#response">
        <p>When a POST is performed to wwdocuments with an empty JSON body</p>
        <div h:request="">
            POST /v2.1/domain/wwdocuments HTTP/1.1
            Authorization: #token
            Content-type: application/json
            VRE_ID: WomenWriters

            {}
        </div>
        <p>The server will respond with a 400 statusCode</p>
        <div h:response="validatePostWithEmptyBodyResponse">
            HTTP/1.1 400

            [...] missing property '@type' [...]
        </div>
    </aside>

    <aside class="example" h:http="#createResponse">
        <p>When a valid POST is performed to wwdocuments</p>
        <div h:request="">
            POST /v2.1/domain/wwdocuments HTTP/1.1
            Authorization: #token
            Content-type: application/json
            VRE_ID: WomenWriters

            {
                "@type": "wwdocument",
                "documentType": "PERIODICAL",
                "englishTitle": "English title",
                "title": "Title",
                "date": "1850",
                "reference": "A reference",
                "notes": "A note",
                "links": [{
                    "url": "http://example.com",
                    "label": "Test link"
                }]
            }
        </div>
        <p>The server will respond with a location header containing the URL of the created resource</p>
        <div h:response="validateIdFromLocationHeader">
            HTTP/1.1 201
            Location:
        </div>
    </aside>
    <span c:execute="#recordId=getRecordId()"></span>
    <p>
        The field <b>documentType</b> should have one of these values:
        <ul>
            <li>UNKNOWN</li>
            <li>ANTHOLOGY</li>
            <li>ARTICLE</li>
            <li>AWARD</li>
            <li>CATALOGUE</li>
            <li>COMPILATION</li>
            <li>DIARY</li>
            <li>LETTER</li>
            <li>LIST</li>
            <li>MONOGRAPH</li>
            <li>PERIODICAL</li>
            <li>PICTURE</li>
            <li>PUBLICITY</li>
            <li>SHEETMUSIC</li>
            <li>THEATERSCRIPT</li>
            <li>WORK</li>
        </ul>
    </p>

    <p>
        The field <b>resourceType</b> is currently not used by the frontend but should be one of these values:
        <ul>
            <li>UNKNOWN</li>
            <li>IMAGE</li>
            <li>SOUND</li>
            <li>TEXT</li>
        </ul>
        It will now default to <b>UNKNOWN</b>
    </p>

</section>

<section id="GETsingle">
    <h2>Performing GET to the recently created wwdocument resource</h2>
    <aside class="example" h:http="#response">
        <p>When a GET is performed to wwdocuments </p>
        <div h:request="">
            GET #createResponse.headers.location HTTP/1.1
            Accept: application/json
        </div>
        <p>The server will respond with the created resource</p>
        <div h:response="">
            HTTP/1.1 200
            Content-type: application/json

            {
                "_id": "#recordId",
                "@type": "wwdocument",
                "@relations": {},
                "@relationCount": 0,
                "@variationRefs": [
                    {
                        "id": "#recordId",
                        "type": "wwdocument"
                    },
                    {
                        "id": "#recordId",
                        "type": "document"
                    }
                ],
                "^created": {
                    "username": "/.*/",
                    "userId": "/.*/",
                    "vreId": "WomenWriters",
                    "timeStamp": "/^\\d+$/"
                },
                "^modified": {
                    "username": "/.*/",
                    "userId": "/.*/",
                    "vreId": "WomenWriters",
                    "timeStamp": "/^\\d+$/"
                },
                "^rev": 1,
                "^pid": "/.*/",
                "^deleted": false,
                "date": "1850",
                "title": "Title",
                "englishTitle": "English title",
                "documentType": "PERIODICAL",
                "reference": "A reference",
                "notes": "A note",
                "links": [{
                    "url": "http://example.com",
                    "label": "Test link"
                }]
            }
        </div>
        <span style="color: red">TODO:</span> extend JSON
    </aside>
</section>

<section id="DELETE">
    <h2>Deleting a wwdocument</h2>
    <aside class="example" h:http="#response">
        <p>When a DELETE is sent to an existing wwdocument resource</p>
        <div h:request="">
            DELETE #createResponse.headers.location HTTP/1.1
            Authorization: #token
            VRE_ID: WomenWriters
        </div>
        <p>The server will respond with statusCode 204 no content</p>
        <div h:response="">
            HTTP/1.1 204
        </div>
    </aside>
</section>

<section id="GET-after-DELETE">
    <h2>Trying to retrieve the deleted record</h2>
    <aside class="example" h:http="#response">
        <p>When a GET is sent to the recently deleted wwdocument resource</p>
        <div h:request="">
            GET #createResponse.headers.location HTTP/1.1
            Accept: application/json
        </div>
        <p>The server will respond with statusCode 404 not found</p>
        <div h:response="">
            HTTP/1.1 404
        </div>
    </aside>
</section>


<!--<section id="GETSingle">-->
    <!--<h2>Get a single wwdocument</h2>-->
    <!--<aside class="example" h:http="#response">-->

        <!--<p>When an unknown wwdocument with id '00000000-0000-0000-0000-000000000000' is requested.</p>-->

      <!--<span h:request="">-->
        <!--GET /v2.1/domain/wwdocuments/00000000-0000-0000-0000-000000000000 HTTP/1.1-->
        <!--Accept: application/json-->
      <!--</span>-->
        <!--<p>The response will look like this:</p>-->
      <!--<span h:response="">-->
        <!--HTTP/1.1 404-->
        <!--Content-Type: text/html;charset=utf-8-->
      <!--</span>-->
    <!--</aside>-->

    <!--<aside class="example" h:http="#response">-->

        <!--<p>A wwdocument with id '5d4e0b05-185d-423d-abee-07acc3e9739a' is known to have both @variationRefs and @relations/</p>-->

        <!--<span h:request="">-->
            <!--GET /v2.1/domain/wwdocuments/5d4e0b05-185d-423d-abee-07acc3e9739a HTTP/1.1-->
            <!--Accept: application/json-->
        <!--</span>-->
        <!--<span h:response="">-->
            <!--HTTP/1.1 200-->
            <!--Content-Type: application/json-->

            <!--{-->
                <!--_id: "5d4e0b05-185d-423d-abee-07acc3e9739a",-->
                <!--@properties: {},-->
                <!--@relationCount: "?Number",-->
                <!--@relations: {},-->
                <!--@type: "wwdocument",-->
                <!--@variationRefs: [-->
                    <!--{id: "5d4e0b05-185d-423d-abee-07acc3e9739a", type: ".*document"}-->
                <!--],-->
                <!--^created: {-->
                    <!--timeStamp: "?Number",-->
                    <!--userId: ".*",-->
                    <!--username: ".*",-->
                    <!--vreId: ".*"-->
                <!--},-->
                <!--^deleted: "?Boolean",-->
                <!--^displayName: ".*"-->
            <!--}-->
        <!--</span>-->
        <!--&lt;!&ndash; TODO: this test does not make assertions on all properties of a wwdocument yet &ndash;&gt;-->
    <!--</aside>-->
<!--</section>-->

</body>
</html>

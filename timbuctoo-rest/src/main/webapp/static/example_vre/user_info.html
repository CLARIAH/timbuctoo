<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>User_info</title>
<link href="../css/static-html.css" rel="stylesheet" type="text/css" />
</head>
<body>
	<h1 id="title">user data</h1>
	<table id="data" border="1">
		<tr>
			<th>key</th>
			<th>value</th>
		</tr>
	</table>

	<script type="text/javascript"
		src="http://code.jquery.com/jquery-1.9.1.js"></script>
	<script type="text/javascript" src="../config.js"></script>
	<script type="text/javascript">
	$(document).ready(function(){
		var accessToken = getParameterByName('hsid');
		var wl = window.location;
	    var hsurl = wl.origin + wl.pathname;
	    
	    if (accessToken.length < 1) {
	         window.location.replace('https://'+ window.config.securityUri+'/saml2/login?hsurl=' + encodeURIComponent(hsurl));
	    }
	    
		$.ajax({
			url: 'http://' + window.config.serverUri + '/system/users/me',
			headers:{
				Authorization: accessToken,
				VRE_ID: "example_vre"
			},
			error: function(data){
				if(data.status===401){
					window.location.replace('https://secure.huygens.knaw.nl/saml2/login?hsurl=' + encodeURIComponent(hsurl));
					
				}
			},			
			success:function(data){
				var table = $('#data');
				$.each(data, function(key, value){
					var tr = null;
					if(value instanceof Object){
						var subTable = $('<table>');
						$.each(value, function(subKey, subValue){
							subTable.append('<tr><td>' + subKey + '</td><td>' + subValue + '</td></tr>');
						});
															
						tr  = $('<tr>');
						var keyTd = $('<td>');						
						keyTd.append(key);
						var valueTd = $('<td>');
						valueTd.append(subTable);
						tr.append(keyTd);
						tr.append(valueTd);
					}
					else{
						tr  = '<tr><td>' + key + '</td><td>' + value + '</td></tr>';
					}
					
					table.append(tr);
				});
			},
			type: 'GET'
		});
		
		function getParameterByName(name) {
		    name = name.replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");
		    var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
		        results = regex.exec(location.search);
		    return results == null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
		}
	});
</script>
</body>
</html>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<title>Repository Search</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link href="css/static-html.css" rel="stylesheet" type="text/css" />
</head>

<body>
<h1>Repository Search</h1>
<form id="formSearch" name="formSearch">

<h2>Query</h2>
<table>
<tr>
  <td>Text</td>
  <td><input name="" type="text" id="searchtext"/></td>
</tr>
</table>
<p><a href="#" onclick="doPost()">Submit query</a></p>

<h2>Results</h2>
<table>
<tr>
  <td>Search id</td>
  <td><input name="" type="text" id="searchid" disabled="disabled"/></td>
</tr>
<tr>
  <td>Start</td>
  <td><input name="" type="text" id="start" value="0"/></td>
</tr>
<tr>
  <td>Rows</td>
  <td><input name="" type="text" id="rows" value="10"/></td>
</tr>
</table>
<p><a href="#" onclick="doGet()">Show results</a></p>

<div id="results">
</div>
</form>

<script src="http://code.jquery.com/jquery-1.9.1.js"></script>
<script>
  var baseUrl = 'http://localhost:8080/repository/';
  var searchUrl = baseUrl + 'search';
  var personUrl = baseUrl + 'resources/person/';

  function doPost() {
    var query = 'facet_t_name:' + $('#searchtext').val();
    jQuery.ajax({
      url: searchUrl,
      type: 'POST',
      data: {'type': 'person', 'q': query, 'sort': 'id'},
      contentType: 'application/x-www-form-urlencoded; charset=utf-8',
      success: function (data) {
        var queryId = data.queryId || 'None';
        $('#searchid').val(queryId);
      }
    });
  }

  function doGet() {
    var id = $('#searchid').val();
    var start = $('#start').val() || '0';
    var rows = $('#rows').val() || '10';
    jQuery.ajax({
      url: searchUrl,
      type: 'GET',
      data: {'id': id, 'start': start, 'rows': rows},
      contentType: 'application/json; charset=utf-8',
      success: function (data) {
        var html = '<table><tr><th>Id</th><th>Name</th></tr>';
        $.each(data, function (i, item) {
          html += '<tr><td><a href="' + personUrl + item._id + '">' + item._id + '</a></td><td>' + item.name + '</td></tr>';
        });
        html += '</table>';
        $('#results').html(html);
      }
    });
  }

  $(document).ready(function() {
    $('#searchid').val('QRY0000000001');
    $('#results').html('No results (yet)');
  });
</script>
</body>

</html>
